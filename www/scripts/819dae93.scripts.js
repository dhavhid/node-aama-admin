"use strict";window.App=angular.module("aama",["ngResource","ngSanitize","ngAnimate","gettext","angular-toArrayFilter","permission","ui.router","swipe","angularFileUpload","mgcrea.ngStrap","colorpicker.module","pouchdb","ngTagsInput","ui.tree","textAngular"]).config(["$provide",function(a){a.decorator("$exceptionHandler",["$delegate","$window",function(a,b){return function(c,d){a(c,d),b.log&&log(c.stack,c.message)}}])}]).config(["$compileProvider","$locationProvider","$httpProvider","$provide",function(a,b,c,d){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|ghttps?|ms-appx|x-wmapp0):/),a.imgSrcSanitizationWhitelist(/^\s*((https?|ftp|file|blob|x-wmapp0):|data:image\/)/),b.html5Mode(!!window.globalVars.html5mode).hashPrefix("!"),!c.defaults.headers.get&&(c.defaults.headers.get={}),c.defaults.headers.get["If-Modified-Since"]="0",c.interceptors.push(["$q","$rootScope","$timeout",function(a,b,c){function d(a){e+=a,c(function(){b.loading.activeRequests=e})}b.loading={msg:"Loading...",activeRequests:0};var e=0;return{request:function(b){return d(1),b||a.when(b)},response:function(b){return d(-1),b||a.when(b)},responseError:function(b){return d(-1),a.reject(b)}}}]),d.decorator("$uiViewScroll",function(){return function(a){}})}]).config(["$modalProvider","$timepickerProvider","$datepickerProvider","tagsInputConfigProvider",function(a,b,c,d){_.assign(a.defaults,{animation:"am-fade",backdrop:!0,placement:"center"}),_.assign(b.defaults,{minuteStep:5,length:12,autoclose:!1,useNative:!0,iconUp:"icon-chevron-up",iconDown:"icon-chevron-down",trigger:"focus",placement:"bottom-right",container:"body",timeFormat:"shortTime",roundDisplay:!0,arrowBehavior:"picker"}),_.assign(c.defaults,{dateFormat:"dd/MM/yyyy",startWeek:0,autoclose:!0,useNative:!0,iconLeft:"icon-chevron-left",iconRight:"icon-chevron-right",trigger:"focus",placement:"bottom-right",container:"body"}),d.setDefaults("tagsInput",{replaceSpacesWithDashes:!1,minLength:1,displayProperty:"name",removeTagSymbol:""}),d.setDefaults("autoComplete",{maxResultsToShow:1e3,loadOnFocus:!0,minLength:2})}]).factory("moment",function(){return window.moment}).run(["$rootScope","$state","__","Config",function(a,b,c,d){a.$state=b,a.Config=_.extend(d,d[d.config]),FastClick.attach(document.body),document.documentMode&&(a.isIE=!0,angular.element(document.body).addClass("ie"));var e=null;angular.element(document.body).on("dragover",function(a){var b=a.dataTransfer||c.getObjVal(a,"originalEvent.dataTransfer")||{},d=c.getObjVal(b,"types",[]),f=!1;if(d)for(var g=0;g<d.length;g++)if("Files"===d[g]){f=!0;break}f?(e&&clearTimeout(e),angular.element(document.body).addClass("file-over")):(angular.element(document.body).removeClass("file-over"),angular.element(document.querySelectorAll(".nv-file-over")).removeClass("nv-file-over"))}),angular.element(document.body).on("drop dragend dragleave",function(){e&&clearTimeout(e),e=setTimeout(function(){angular.element(document.body).removeClass("file-over"),angular.element(document.querySelectorAll(".nv-file-over")).removeClass("nv-file-over")},100)});var f;document.addEventListener("invalid",function(a){var b=a.target;if(!b||!b.getBoundingClientRect||f)return!1;var c=b.getBoundingClientRect().top+window.scrollY;window.scrollTo(0,c-100),f=setTimeout(function(){f=null},200)},!0)}]),App.config(["$urlRouterProvider","$stateProvider",function(a,b){a.otherwise(function(a){var b=a.get("$state");b.go("login")});var c={Data:["Data",function(a){return a.inited.then(function(){return a},function(){return a})}]};b.state("login",{url:"/login",templateUrl:"views/pages/login.html",controller:"AuthCtrl",data:{inactivePageBg:!0,emptyHeader:!0,notUseLeftList:!0,permissions:{only:["guest"],redirectTo:"users.profile"}}}).state("password",{url:"/password",views:{"":{template:'<ui-view autoscroll="true" class="view-change anim-fade-in" />'}},"abstract":!0}).state("password.restore",{url:"/restore",templateUrl:"views/pages/password.restore.html",controller:"AuthCtrl",data:{inactivePageBg:!0,emptyHeader:!0,notUseLeftList:!0,permissions:{only:["guest"],redirectTo:"users.profile"}}}).state("password.reset",{url:"/reset/:resetToken",templateUrl:"views/pages/password.reset.html",controller:"AuthCtrl",data:{inactivePageBg:!0,emptyHeader:!0,notUseLeftList:!0,permissions:{only:["guest"],redirectTo:"users.profile"}}}).state("users",{url:"/users",views:{"":{template:'<ui-view autoscroll="true" class="view-change anim-fade-in" />'},list:{templateUrl:"views/list/leftList.html"}},"abstract":!0,resolve:c}).state("users.add",{url:"/add/:role/:entityId",controller:"UsersCtrl",templateUrl:"views/pages/users.html",data:{menuItem:"Users",permissions:{only:["admin"],redirectTo:"login"}}}).state("users.profile",{url:"/:userId",controller:"UsersCtrl",templateUrl:"views/pages/users.html",data:{menuItem:"Users",permissions:{only:["admin"],redirectTo:"login"}}}).state("categories",{url:"/categories/:categoryType",views:{"":{template:'<ui-view autoscroll="true" class="view-change anim-fade-in" />'},list:{templateUrl:"views/list/leftList.html"}},"abstract":!0,resolve:c}).state("categories.add",{url:"/add",controller:"CategoriesCtrl",templateUrl:"views/pages/categories.html",data:{menuItem:"Categories",permissions:{only:["admin"],redirectTo:"login"}}}).state("categories.profile",{url:"/:categoryId",controller:"CategoriesCtrl",templateUrl:"views/pages/categories.html",data:{menuItem:"Categories",permissions:{only:["admin"],redirectTo:"login"}}}).state("contents",{url:"/contents/:contentType",views:{"":{template:'<ui-view autoscroll="true" class="view-change anim-fade-in" />'},list:{templateUrl:"views/list/leftList.html"}},"abstract":!0,resolve:c}).state("contents.add",{url:"/add",controller:"ContentsCtrl",templateUrl:"views/pages/contents.html",data:{menuItem:"Contents",permissions:{only:["admin"],redirectTo:"login"}}}).state("contents.profile",{url:"/:contentId",controller:"ContentsCtrl",templateUrl:"views/pages/contents.html",data:{menuItem:"Contents",permissions:{only:["admin"],redirectTo:"login"}}}).state("pageOrganization",{url:"/page-organization",templateUrl:"views/pages/pageOrder.html",controller:"PageOrderCtrl",data:{notUseLeftList:!0,menuItem:"Page organization",permissions:{only:["admin"],redirectTo:"login"}}}).state("forms",{url:"/forms",views:{"":{template:'<ui-view autoscroll="true" class="view-change anim-fade-in" />'},list:{templateUrl:"views/list/leftList.html"}},"abstract":!0,resolve:c}).state("forms.add",{url:"/add",controller:"FormsCtrl",templateUrl:"views/pages/forms.html",data:{menuItem:"Forms",permissions:{only:["admin"],redirectTo:"login"}}}).state("forms.view",{url:"/:formId",controller:"FormsCtrl",templateUrl:"views/pages/forms.html",data:{menuItem:"Forms",permissions:{only:["admin"],redirectTo:"login"}}})}]),App.constant("Config",{local:{serverUrl:"http://10.0.0.109:3000/"},dev:{serverUrl:"http://52.88.240.184/service/api/"},prod:{serverUrl:"http://service.aama.com/"},defaults:{location:{lat:36.1539816,lng:-95.992775},lang:"en_US"},defaultDbDriver:"localStorage",dbName:"aama",uniqStorageKey:"id",debug:!1,config:"dev"}),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},Array.prototype.sortByField=function(a,b){return this.sort(function(c,d){if("string"==typeof a&&(a=a.split(".")),!a||!a.length)return 0;for(var e=void 0,f=void 0,g=0,h=a.length;h>g;g++)e="undefined"==typeof c[a[g]]?void 0:c=c[a[g]],f="undefined"==typeof d[a[g]]?void 0:d=d[a[g]];return b?f-e:e-f})},Array.prototype.searchByCriteria=function(a,b){if(!a||"object"!=typeof a)return{};for(var c=0,d=this.length;d>c;c++){var e=this[c],f=!0;for(var g in a)if(a.hasOwnProperty(g)){if("undefined"==typeof e[g]){f=!1;break}if(b&&a[g]!==e[g]||!b&&a[g]!=e[g]){f=!1;break}}if(f)return{item:e,index:c}}return{}},Array.prototype.deleteByCriteria=function(a,b){var c=this.searchByCriteria(a,b);return c.item?(this.splice(c.index,1),!0):!1},String.prototype.lpad=function(a,b){for(var c=this;c.length<b;)c=a+c;return c},Number.prototype.round=function(a){if(null==a||0>a)return this;var b=this.toString(),c=b.indexOf(".");if(-1==c)return this;var d=c+1+a;if(d>=b.length)return this;var e=parseInt(b.substring(0,c),10),f=parseInt(b.substring(c+1,c+1+a),10)||0,g=Math.pow(10,a),h=parseInt(b.charAt(d),10);return h>=5&&(0==a?e++:f+1==g?(e++,f=0):f++),new Number(parseFloat(e+"."+f.toString().lpad("0",a))).valueOf()},angular.module("aama").run(["gettextCatalog",function(a){a.setStrings("en_US",{dropdown_checkbox:"Checkbox",dropdown_group:"Group",dropdown_info:"Info text",dropdown_radio:"Radio",dropdown_select:"Select",dropdown_terms:"Waiver",dropdown_text:"Text",dropdown_textarea:"Text area"})}]),App.config(function(){return window.CKEDITOR?void window.CKEDITOR.on("dialogDefinition",function(a){var b=a.data,c=1,d=4,e=8;if("image"!==b.name)return!0;var f=a.data.definition,g=f.getContents("info"),h=g.elements,i={id:"txtTitle",type:"text",label:"Title","default":"",onChange:function(){var a=this.getDialog();return a.originalElement&&a.preview?(a.commitContent(d,a.preview),0):1},setup:function(a,b){a===c&&this.setValue(b.getAttribute("title"))},commit:function(a,b){a===c?(this.getValue()||this.isChanged())&&b.setAttribute("title",this.getValue()):a===d?b.setAttribute("title",this.getValue()):a===e&&b.removeAttribute("title")}};h.splice(1,0,i)}):!1}).config(["$provide",function(a){function b(){if(document.dispatchEvent&&document.createEvent){var a=document.createEvent("MouseEvents");a.initEvent("click",!0,!0),document.dispatchEvent(a,!0)}}function c(a){return a.stopPropagation(),a.preventDefault(),!1}a.decorator("taOptions",["$delegate","taRegisterTool","Modal","__","taToolFunctions","$timeout","Upload",function(a,d,e,f,g,h,i){function j(a,b){var c=i.getWysiwygEmbedFromSrc(b);if(c){if("object"!=typeof c||!c.then)return a.wrapSelection("insertHTML","<p>"+c+"</p>",!0);c.then(function(b){return a.wrapSelection("insertHTML","<p>"+b+"</p>",!0)})}}function k(a,b,c,d){c=c||"",d=d||"";var e='<p><img src="'+b+'" alt="'+d+'" title="'+c+'"></p>';a.wrapSelection("insertHTML",e,!0)}var l=a;return l.toolbar=[["redo","undo"],["fontName","fontSize","fontColor","backgroundColor"],["h1","h2","h3","h4","h5","h6"],["p","pre","quote"],["bold","italics","underline","strikeThrough","ul","ol"],["justifyLeft","justifyCenter","justifyRight","justifyFull","indent","outdent"],["html","uploadImage","addVideo","addFileFromGallery","insertLink"]],l.classes={focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-tool",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"},d("fontName",{display:"<span class='bar-btn-dropdown dropdown'><button class='btn btn-wysiwyg dropdown-toggle' type='button' ng-disabled='showHtml()'><i class='icon-font'></i><i class='caret'></i></button><ul class='dropdown-menu'><li ng-repeat='o in options'><button class='btn' style='font-family: {{o.css}}; width: 100%' type='button' ng-click='action($event, o.css)' ng-class=\"{'selected': scope.selected === o.val}\"></i>{{o.name}}</button></li></ul></span>",action:function(a,c){a.stopPropagation&&(a.stopPropagation(),b());var d=this.scope||{};return d.selected=c.replace(/\'/g,""),this.$editor().wrapSelection("fontName",c)},activeState:function(a){if(a&&"#document"===a.nodeName)return!1;if(a){var b=this.scope||{};b.selected=a.attr("face")||a.css("font-face")}return!1},scope:{selected:void 0},options:[{name:"Sans-Serif",css:"Arial, Helvetica, sans-serif",val:"Arial, Helvetica, sans-serif"},{name:"Serif",css:"'times new roman', serif",val:"times new roman, serif"},{name:"Wide",css:"'arial black', sans-serif",val:"arial black, sans-serif"},{name:"Narrow",css:"'arial narrow', sans-serif",val:"arial narrow, sans-serif"},{name:"Comic Sans MS",css:"'comic sans ms', sans-serif",val:"comic sans ms, sans-serif"},{name:"Courier New",css:"'courier new', monospace",val:"courier new, monospace"},{name:"Garamond",css:"garamond, serif",val:"garamond, serif"},{name:"Georgia",css:"georgia, serif",val:"georgia, serif"},{name:"Tahoma",css:"tahoma, sans-serif",val:"tahoma, sans-serif"},{name:"Trebuchet MS",css:"'trebuchet ms', sans-serif",val:"trebuchet ms, sans-serif"},{name:"Helvetica",css:"'Helvetica Neue', Helvetica, Arial, sans-serif",val:"Helvetica Neue, Helvetica, Arial, sans-serif"},{name:"Verdana",css:"verdana, sans-serif",val:"verdana, sans-serif"},{name:"Proxima Nova",css:"proxima_nova_rgregular",val:"proxima_nova_rgregular"}]}),d("fontSize",{display:"<span class='bar-btn-dropdown dropdown'><button class='btn btn-wysiwyg dropdown-toggle' type='button' ng-disabled='showHtml()'><i class='icon-format-size'></i><i class='caret'></i></button><ul class='dropdown-menu' style='width: 50px;'><li ng-repeat='o in options'><button class='btn' style='font-size: {{o.css}}; width: 100%' type='button' ng-click='action($event, o.value)' ng-class=\"{'selected': scope.selected == o.value}\"></i> {{o.name}}</button></li></ul></span>",action:function(a,c){a.stopPropagation&&(a.stopPropagation(),b());var d=this.scope||{};return d.selected=c,this.$editor().wrapSelection("fontSize",parseInt(c))},activeState:function(a){if(a&&"#document"===a.nodeName)return!1;if(a){var b=this.scope||{};b.selected=a.attr("size")||a.css("font-size")}return!1},scope:{selected:void 0},options:[{name:1,css:"6px",value:1},{name:2,css:"9px",value:2},{name:3,css:"12px",value:3},{name:4,css:"14px",value:4},{name:5,css:"16px",value:5},{name:6,css:"18px",value:6},{name:7,css:"20px",value:7}]}),d("backgroundColor",{display:'<button type="button" colorpicker="rgba" colorpicker-position="bottom" class="btn btn-wysiwyg btn-tool" ng-model="scope.color" ng-change="scope.color && action(scope.color)"><i class="icon-format-color-fill"></i><span class="color-preview" ng-style="{\'background-color\': scope.color}"></span><i class="caret"></i></button>',action:function(a){return this.$editor().wrapSelection?this.$editor().wrapSelection("backColor",a):void 0},scope:{color:"#fff"}}),d("fontColor",{display:'<button type="button" colorpicker colorpicker-position="bottom" class="btn btn-wysiwyg btn-tool" ng-model="scope.color" ng-change="scope.color && action(scope.color)"><i class="icon-text"></i><span class="color-preview" ng-style="{\'background-color\': scope.color}"></span><i class="caret"></i></button>',action:function(a){return this.$editor().wrapSelection?this.$editor().wrapSelection("foreColor",a):void 0},scope:{color:"#000"}}),d("addVideo",{iconclass:"icon-youtube-play",tooltiptext:"Insert video",action:function(){var a,b=this.$editor();return a=window.prompt("Enter Youtube or Vimeo url","https://"),a&&""!==a&&"https://"!==a&&j(b,a),!1},onElementSelect:{element:"img",onlyWithAttrs:["ta-insert-video"],action:g.imgOnSelectAction}}),d("uploadImage",{iconclass:"icon-image",tooltiptext:"Upload images",action:function(a,b){var c=f.getObjVal(this,"$parent.$parent",this),d=this.$editor(),g=e.pageModal(c,"views/components/uploadImageModal.html",{},"slim");return g.onResult=function(c){return b(),c?(h(function(){c.uploaded instanceof Array?_.forEach(c.uploaded,function(a){b(),k(d,a.source)}):c.uploaded&&k(d,c.uploaded.source),c.url&&(b(),k(d,c.url)),d.wrapSelection("insertHTML","<p><br></p>",!0)},200),void a.resolve()):a.resolve()},!1},onElementSelect:{element:"img",action:function(a,b,d){function e(){d.displayElements.popover.on("mousedown",function(a,b){return b&&angular.extend(a,b),a.preventDefault(),!1})}function f(){d.updateTaBindtaTextElement(),d.hidePopover(),e()}g.imgOnSelectAction.apply(this,arguments),d.displayElements.popover.off("mousedown");var h=d.displayElements.popoverContainer,i=angular.element('<div class="form-group"><label>Image Alt</label><input type="text" class="form-control" tabindex="1" value="'+(b.attr("alt")||"")+'"></div>');i.on("click keyup",c);var j=angular.element('<div class="form-group"><label>Image Title</label><input type="text" class="form-control" tabindex="1" value="'+(b.attr("title")||"")+'"></div>');j.on("click keyup",c);var k=angular.element('<button type="button" class="btn btn-default pull-right" unselectable="on" tabindex="-1">Save</button>');k.on("click",function(a){a.preventDefault(),b.attr("alt",i.find("input").val()),b.attr("title",j.find("input").val()),f()}),h.append(i).append(j).append(k)}}}),d("addFileFromGallery",{iconclass:"icon-attach-file",tooltiptext:"Add file from gallery",action:function(a,b){var c=f.getObjVal(this,"$parent.$parent",this),d=e.pageModal(c,"views/components/filesGalleryModal.html",{},"slim"),g=this.$editor();return d.onResult=function(c){return b(),c?(h(function(){c instanceof Object&&_.forEach(c,function(a){if("image"===a.type)k(g,a.source,a.title,a.altTag);else{if("video"!==a.type)return g.wrapSelection("createLink",a.source,!0);j(g,a.source)}}),g.wrapSelection("insertHTML","<p><br></p>",!0)},200),void a.resolve()):a.resolve()},!1}}),l}]),a.decorator("taTools",["$delegate",function(a){var b=a;return b.bold.iconclass="icon-format-bold",b.italics.iconclass="icon-format-ital",b.underline.iconclass="icon-format-underline",b.strikeThrough.iconclass="icon-format-strikethrough",b.ul.iconclass="icon-format-list-bulleted",b.ol.iconclass="icon-format-list-numbered",b.undo.iconclass="icon-undo",b.redo.iconclass="icon-redo",b.justifyLeft.iconclass="icon-format-align-left",b.justifyRight.iconclass="icon-format-align-right",b.justifyCenter.iconclass="icon-format-align-center",b.justifyFull.iconclass="icon-format-align-justify",b.indent.iconclass="icon-format-indent-increase",b.outdent.iconclass="icon-format-indent-decrease",b.clear.iconclass="icon-block",b.insertLink.iconclass="icon-link",b.quote.iconclass="icon-format-quote",b.insertImage.iconclass="icon-image",b.insertLink.iconclass="icon-link",b.insertVideo.iconclass="icon-youtube-play",b.html.iconclass="icon-code",b}])}]).factory("youtubeParser",function(){return function(a){var b=a&&a.match(/^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);return b&&11===b[2].length?b[2]:!1}}).factory("taReverseCustomRenderers",["youtubeParser",function(a){return function(b){var c=angular.element("<div></div>");c.html(b);var d=c.find("iframe");return _.forEach(d,function(b){var c=a(b.src);if(!c)return!0;var d='<img class="ta-insert-video" src="https://img.youtube.com/vi/'+c+'/hqdefault.jpg" ta-insert-video="'+b.src+'" contenteditable="false" allowfullscreen="true" frameborder="0"';b.width&&(d+=' width="'+b.width+'"'),b.height&&(d+=' height="'+b.height+'"'),d+=" />",angular.element(b).replaceWith(d)}),c.html()}}]),App.run(["$rootScope","$window","$location",function(a,b,c){b.stateHistory=[],a.$on("$locationChangeStart",function(d,e,f){var g=c.$$path||"",h=b.stateHistory.length;g&&(a.isBackButtonPushed&&b.stateHistory[h-2]&&b.stateHistory[h-2]===g?(angular.element(document.querySelectorAll("ui-view")).addClass("reverse"),a.isReverse=!0,b.stateHistory.pop()):(angular.element(document.querySelectorAll("ui-view")).removeClass("reverse"),a.isReverse=!1,b.stateHistory=_.without(b.stateHistory,g),b.stateHistory.push(g)),a.isBackButtonPushed=!1)})}]),App.run(["$window","gettextCatalog","Storage","Config",function(a,b,c,d){a.lang=function(a){return b.getString(a)},a.currentLang=function(a){return a&&(b.setCurrentLanguage(a),c.set("lang",a)),b.currentLanguage},a.currentLang(c.get("lang",d.defaults.lang))}]),App.run(["$window","$rootScope","Config",function(a,b,c){c.debug&&!document.querySelector("#debugger")&&!function(){var a=document.querySelector("#debugger"),b=document.querySelector("#logger"),c=document.querySelector("#debugger-switcher");a=document.createElement("div"),a.id="debugger",a.className="debugger",a.innerHTML='<div id="logger" class="logger"></div><div id="debugger-switcher"></div><div class="clear-btn"><button>Clear</button></div>',document.body.appendChild(a),b=document.querySelector("#logger"),c=document.querySelector("#debugger-switcher"),a.querySelector("button").onclick=function(){b.innerHTML="",c.style.zoom=1};var d='			#debugger{\n				position: fixed;\n				z-index: 100000;\n				top: 0px;\n				bottom: 0px;\n				right: 0px;\n				-webkit-transform: translate3d(100%, 0, 0);\n				transform: translate3d(100%, 0, 0);\n				-webkit-transition: transform 0.2s ease;\n				transition: transform 0.2s ease;\n				z-index: 2000;\n				background-color: rgba(255,255,255,.8);\n				width: 80%;\n				color: #000;\n			}\n			#logger{\n				border: 1px solid #ccc;\n				overflow: auto;\n				position: absolute;\n				top: 0px;\n				left: 0px;\n				right: 0px;\n				bottom: 40px;\n			}\n			#logger:empty + #debugger-switcher{\n				background-color: rgba(255,255,0,.4);\n			}\n			#debugger-switcher{\n				content: "";\n				display: block;\n				position: absolute;\n				-webkit-transform: translateZ(0);\n				transform: translateZ(0);\n				z-index: 100000;\n				left: -40px;\n				top: 80px;\n				width: 40px;\n				height: 40px;\n				background-color: rgba(255,0,0,.4);\n				border-radius: 50%;\n			}\n			#debugger .log-event{\n				border-top: 1px dashed #ccc;\n			}\n			#debugger .log-event pre{\n				line-height: 1;\n				background-color: transparent;\n				border: none;\n				padding: 5px;\n				font-size: 10px;\n				margin: 0;\n			}\n			#debugger .clear-btn{\n				text-align: center;\n				position: absolute;\n				bottom: 0px;\n				left: 0px;\n				right: 0px;\n			}\n			#debugger .clear-btn button{\n				width: 100%;\n				height: 40px;\n			}',e=document.createElement("style");e.type="text/css",e.styleSheet?e.styleSheet.cssText=d:e.appendChild(document.createTextNode(d)),document.querySelector("head").appendChild(e),c.onclick=function(){var b=window.getComputedStyle(a).transform||window.getComputedStyle(a)["-webkit-transform"]||"",c=b.replace(/matrix\((.*)\)/gi,"$1");if(c){var d=c.split(",");a.style["-webkit-transform"]=a.style.transform=d[4]&&parseInt(d[4])?"translate3d(0,0,0)":"translate3d(100%,0,0)"}}}(),a.log=function(a,b,d,e,f){if("undefined"==typeof d&&(d=!0),"undefined"==typeof f&&(f=!0),"undefined"==typeof e&&(e=!0),!c.debug&&f)return!1;if(b=b||"",e&&(b=(new Date).toLocaleTimeString()+" "+b),b&&(b+=": "),"object"==typeof a&&a){try{var g=angular.toJson(a,d)}catch(h){g=a.toString()}var i=b+g}else i=b+a;if(console.log(i),c.debug){var j=document.querySelector("#logger"),k=document.querySelector("#debugger-switcher"),l=document.createElement("div");l.className="log-event",l.innerHTML="<pre>"+i+"</pre>",j.appendChild(l),j.scrollTop=j.scrollHeight,k.style.zoom=1}return i}}]),App.directive("bgImg",["ImageParams","$parse",function(a,b){return function(c,d,e){e.$observe("bgImg",function(f){var g=e.hint||"",h=b(e.broadcast)(),i=e.defaultImage;d.removeClass("image-loaded"),d.css({"background-image":"none"}),d.find("load").length||d.append('<load style="display: block; width: 100%; height: 100%; text-align: center; background-color: rgba(0,0,0,0.5); color: #fff;"><div style="position: relative; top: 50%; top: calc(50% - 10px);"><i class="icon-loading spin"></i>'+(g?"&nbsp;"+g:"")+"</div></load>"),f||(d.css({"background-image":"none"}),d.addClass("no-image"),i&&d.css({"background-image":"url('"+i+"')"})),a(f,d,!0).then(function(a){d.removeClass("no-image"),d.css({"background-image":"url('"+f+"')"}),b(e.setMaxWidth)()&&d.css({"max-width":a.width+"px"}),b(e.setMaxHeight)()&&d.css({"max-height":a.height+"px"}),b(e.setWidth)()&&d.css({width:a.width+"px"}),b(e.setHeight)()&&d.css({height:a.height+"px"}),d.addClass("image-loaded"),h&&c.$broadcast("imageLoaded",_.assign(a,{element:d}))},function(){i&&d.css({"background-image":"url('"+i+"')"})})["finally"](function(){d.find("load").remove()})})}}]),App.directive("focus",["$timeout",function(a){return{link:function(b,c,d){b.$watch(d.focus,function(e){e&&a(function(){c[0].focus(),b[d.focus]=!1})})}}}]),App.directive("mInput",["$parse","$compile","$timeout",function(a,b,c){function d(d,e,f,g){function h(){function a(){var a=k[0],b=parseInt(getComputedStyle(a).getPropertyValue("line-height")),c=a.offsetHeight-a.clientHeight,d=+f.maxHeight||1/0,g=2*b+c;if(b){e[0].style.height=e[0].offsetHeight+"px",a.style.height="0px",a.style.overflowY="hidden";var h=a.scrollHeight+c;e[0].style.height="auto",g>h&&(h=g),h>d&&(h=d,a.style.overflowY="auto"),a.style.height=h+"px",a.selectionStart&&(a.selectionStart=a.selectionStart)}}c(a)}var i=e.find("input"),j=e.find("select"),k=e.find("textarea"),l=k.length,m=i.length?i:k.length?k:j,n=m.attr("ng-model"),o=m.scope(),p=a(f.clearable)(),q=a(f.removable)();(p||q)&&(e.addClass("w-btn"),m.after(b('<button type="button" class="btn btn-clear icon-close" ng-click="clear()"></button>')(d)),d.clear=function(){q?(e.remove(),d.onRemove()):(m.val(""),m.triggerHandler("input"))}),f.$observe("label",function(a){d.label=a}),m.after(b("<label>{{label}}</label>")(d)),n&&o.$watch(n,function(a,b){"undefined"==typeof a||""===a||null===a?e.addClass("empty"):(e.removeClass("empty"),l&&h())});var r=m[0]&&(m[0].validity||{}).badInput;!m.val()&&!r&&e.addClass("empty"),m.on("change keydown keypress keyup",function(){var a=(m[0].validity||{}).badInput;this.value||a?e.removeClass("empty"):e.addClass("empty")}),l&&document.defaultView&&document.defaultView.getComputedStyle&&m.on("keypress keyup",h)}var e={onRemove:"&"};return{restrict:"EA",transclude:!1,scope:e,link:d}}]),App.directive("switch",["$parse",function(a){function b(b,c,d,e){b.options={showLabels:!0,onText:"on",offText:"off"},d.$observe("options",function(c){b.options=_.assign(b.options,a(c)())}),d.$observe("disabled",function(a){b.options.disabled=a})}var c='<div class="onoff" ng-click="!options.disabled && (modelVar = !modelVar)">\n			<div class="onoff-bg" ng-class="{\'on\': modelVar}">\n				<span class="on-text" ng-if="options.showLabels">{{options.onText}}</span>\n				<span class="off-text" ng-if="options.showLabels">{{options.offText}}</span>\n				<div class="onoff-pimp z1"></div>\n			</div>\n		</div>',d={modelVar:"=swModel"};return{restrict:"E",transclude:!0,template:c,replace:!1,scope:d,link:b}}]),App.directive("thumb",["$window",function(a){var b={support:!(!a.FileReader||!a.CanvasRenderingContext2D),isFile:function(b){return b instanceof a.File},isImage:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(b)}};return{restrict:"A",template:"<canvas/>",link:function(a,c,d){function e(a){var b=new Image;b.onload=f,b.src=a.target.result}function f(){var a=g.width||this.width/this.height*g.height,b=g.height||this.height/this.width*g.width;h.attr({width:a,height:b}),h[0].getContext("2d").drawImage(this,0,0,a,b)}if(b.support){var g=a.$eval(d.thumb);if(b.isFile(g.file)&&b.isImage(g.file)){var h=c.find("canvas"),i=new FileReader;i.onload=e,i.readAsDataURL(g.file)}}}}}]),App.directive("isolatedScroll",["$parse","__",function(a,b){function c(a){return b.getObjVal(a,["touches",0])||b.getObjVal(a,["originalEvent","touches",0])||{}}function d(d,e,f,g){var h=a(f.isolatedScroll)()!==!1,i=angular.element(document.querySelector("#wrapper"));if(h){e.on("mousewheel DOMMouseScroll",function(a){var c=a.wheelDelta||b.getObjVal(a,"originalEvent.wheelDelta",0)||-a.detail,d=e[0],f=d.scrollTop+d.clientHeight-d.scrollHeight>=0,g=d.scrollTop<=0;(0>c&&f||c>0&&g)&&a.preventDefault()});var j;e.on("touchstart",function(a){j=c(a).clientY}),e.on("touchmove",function(a){var b,d=e[0],f=c(a).clientY,g=d.scrollTop+d.clientHeight-d.scrollHeight>=0,h=d.scrollTop<=0;return f>j?b="down":j>f&&(b="up"),h&&"down"===b||g&&"up"===b||!b?(a.preventDefault(),i.css("overflow-y","hidden")):i.css("overflow-y","auto"),j=c(a).clientY,!0}),e.on("touchend touchcancel",function(a){i.css("overflow-y","auto")})}}return{restrict:"EA",transclude:!1,link:d}}]),App.directive("gmap",["$parse","$rootScope",function(a,b){function c(a,c,d,e){var f;c.on("mousedown touchstart",function(){f&&clearTimeout(f),b.preventMenu=!0}),c.on("mouseup mouseleave touchend touchcancel touchleave",function(){f=setTimeout(function(){b.preventMenu=!1},100)})}return{restrict:"EA",transclude:!1,link:c}}]),App.directive("dropdownToggle",["$document","$location",function(a){var b=null,c=angular.noop;return{restrict:"CA",link:function(d,e,f){e.parent().bind("click",function(){c()}),e.bind("click",function(d){var f=e===b;d.preventDefault(),d.stopPropagation(),!!b&&c(),f||e.hasClass("disabled")||e.prop("disabled")||(e.parent().addClass("open"),b=e,c=function(d){d&&(d.preventDefault(),d.stopPropagation()),a.unbind("click",c),e.parent().removeClass("open"),c=angular.noop,b=null},a.bind("click",c))})}}}]),App.directive("scrollTop",["$timeout",function(a){return{restrict:"A",scope:{trigger:"=scrollTop"},link:function(b,c){b.$watch("trigger",function(){a(function(){c[0].scrollTop=0},200)})}}}]),App.filter("nl2br",["$sce",function(a){return function(b){return b?(b=(b+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br>$2"),a.trustAsHtml(b)):""}}]),App.filter("string",function(){return function(a){if(!a)return"";switch(typeof a){case"string":return a;case"object":return a instanceof Array?a.join(", "):null===a?"":a instanceof Object&&a?angular.toJson(a):a}return a}}),App.filter("emptySign",function(){return function(a){return a?a:"—"}}),App.filter("textLoaded",["$sce",function(a){return function(b){return"undefined"==typeof b?a.trustAsHtml('<i class="icon-loading spin text-loaded"></i>'):b}}]),App.filter("capitalize",function(){return function(a){return a?a.charAt(0).toUpperCase()+a.substr(1):""}}),App.service("Api",["$resource","Config","$q","$http","__","$rootScope",function(a,b,c,d,e,f){function g(a){a.abort=function(a){a=a||"aborted",this.reject(a)}}function h(a,b){b&&(a.timezone&&e.changeTimezoneToLocal(a.timezone,a,b),a.data instanceof Array&&_.forEach(a.data,function(a,c){a.timezone&&e.changeTimezoneToLocal(a.timezone,a,b)}))}function i(a,b,d){var i=c.defer(),j=Math.random(),k=z,l=B;return A&&(A=!1,z=!0),C&&(C=!1,B=!0),!v.activeReqs[b]&&(v.activeReqs[b]=0),v.activeReqs[b]++,g(i),D[j]=i,a.then(function(a){var b=a instanceof Array?[]:{};if(_.forEach(a,function(a,c){("string"!=typeof c||"$"!==c.charAt(0))&&(b[c]=a)}),h(b,d),b.errors=f.checkErrors(a,l,!0),b.errors)throw{errors:b.errors,type:"response"};i.resolve(b)},null,i.notify)["catch"](function(a){k&&"response"!==e.getObjVal(a,"type")&&f.showReqError(a),i.reject(a)})["finally"](function(){D[j]=null,delete D[j],v.activeReqs[b]--}),i}function j(a,b,c,d,e){c&&x&&(c.showHidden=x),w&&(w=!1,u());var f=i(v.r()[a](c,b).$promise,a,e);return d?f:f.promise}function k(a){_.forEach(D,function(b){b.abort(a)})}function l(a){return z=!0,v}function m(){return z=!1,v}function n(a){return"undefined"==typeof a&&(a=!a),z=!!a,v}function o(){return A=!0,z=!1,v}function p(a){return B=!0,v}function q(){return B=!1,v}function r(a){return"undefined"==typeof a&&(a=!a),B=!!a,v}function s(){return C=!0,B=!1,v}function t(a){return"undefined"==typeof a?x=y?1:0:(y=x,x=a?1:0),v}function u(a,b){return"undefined"==typeof a?x=y?1:0:(y=x,x=a?1:0),w=!!b,v}d.defaults.withCredentials=!0;var v=this,w=!1,x=!1,y=!1,z=!0,A=!1,B=!0,C=!1,D={};v.activeReqs={},v.fileUploadUrl=b[b.config].serverUrl+"files/upload/",v.imagesUploadUrl=b[b.config].serverUrl+"files/upload_image/",v.abortAll=k,v.restoreShowHidden=t,v.setShowHidden=u,v.showReqErrors=l,v.hideReqErrorsOnce=o,v.hideReqErrors=m,v.toggleReqErrors=n,v.showRespErrors=p,v.hideRespErrorsOnce=s,v.hideRespErrors=q,v.toggleRespErrors=r,v.r=function(){return a(b[b.config].serverUrl+":action/:method/:id/:param/:subparam",{},{login:{method:"POST",params:{action:"users",method:"session"}},logout:{method:"DELETE",params:{action:"users",method:"session"}},passwordRestore:{method:"POST",params:{action:"users",method:"password",param:"restore"}},passwordReset:{method:"POST",params:{action:"users",method:"password",param:"reset"}},user:{method:"GET",params:{action:"user"}},users:{method:"GET",params:{action:"users"}},userCreate:{method:"POST",params:{action:"users"}},userUpdate:{method:"PUT",params:{action:"users"}},userDelete:{method:"DELETE",params:{action:"users"}},options:{method:"GET",params:{action:"options"}},audiences:{method:"GET",params:{action:"options",
method:"audience"}},subjectMatters:{method:"GET",params:{action:"options",method:"subject_matter"}},tags:{method:"GET",params:{action:"tags"}},forms:{method:"GET",params:{action:"forms"}},formCreate:{method:"POST",params:{action:"forms"}},formUpdate:{method:"PUT",params:{action:"forms"}},formDelete:{method:"DELETE",params:{action:"forms"}},formItems:{method:"GET",params:{action:"form_items"}},formItemCreate:{method:"POST",params:{action:"form_items"}},formItemUpdate:{method:"PUT",params:{action:"form_items"}},formItemDelete:{method:"DELETE",params:{action:"form_items"}},categories:{method:"GET",params:{action:"category"}},categoryCreate:{method:"POST",params:{action:"category"}},categoryUpdate:{method:"PUT",params:{action:"category"}},categoryDelete:{method:"DELETE",params:{action:"category"}},contents:{method:"GET",params:{action:"contents"}},contentCreate:{method:"POST",params:{action:"contents"}},contentUpdate:{method:"PUT",params:{action:"contents"}},contentDelete:{method:"DELETE",params:{action:"contents"}},revisions:{method:"GET",params:{action:"contents",param:"revisions"}},revert:{method:"PUT",params:{action:"contents",param:"revisions"}},files:{method:"GET",params:{action:"files",method:"list"}},file:{method:"GET",params:{action:"files"}},fileUpdate:{method:"PUT",params:{action:"files"}},fileDelete:{method:"DELETE",params:{action:"files"}}})},v.login=function(a,b){return j("login",{email:a,password:b})},v.logout=function(){return j("logout")},v.passwordRestore=function(a){return j("passwordRestore",{email:a})},v.passwordReset=function(a,b){return j("passwordReset",{token:a,password:b})},v.user=function(){return j("user")},v.users=function(a,b){return j("users",{},{id:a,role:b})},v.userCreate=function(a){return j("userCreate",a)},v.userUpdate=function(a,b){return j("userUpdate",b,{id:a})},v.userDelete=function(a){return j("userDelete",{},{id:a})},v.options=function(){return j("options")},v.audiences=function(){return j("audiences")},v.subjectMatters=function(){return j("subjectMatters")},v.tags=function(a){return j("tags",{},a)},v.messages=function(a){return j("messages",{},{id:a})},v.forms=function(a){return j("forms",{},{id:a})},v.formCreate=function(a){return j("formCreate",a)},v.formUpdate=function(a,b){return j("formUpdate",b,{id:a})},v.formDelete=function(a){return j("formDelete",{},{id:a})},v.formItems=function(a){return j("formItems",{},{id:a})},v.formItemCreate=function(a){return j("formItemCreate",a)},v.formItemUpdate=function(a,b){return j("formItemUpdate",b,{id:a})},v.formItemDelete=function(a){return j("formItemDelete",{},{id:a})},v.categories=function(a,b){return b=b||"list",j("categories",{},{method:a,param:"list",mode:b})},v.category=function(a){return j("categories",{},{id:a})},v.categoryCreate=function(a,b){return j("categoryCreate",a,{method:b})},v.categoryUpdate=function(a,b){return j("categoryUpdate",b,{id:a})},v.categoryDelete=function(a){return j("categoryDelete",{},{id:a})},v.contents=function(a,b){return b=b||"list",j("contents",{},{method:a,param:"list",mode:b})},v.content=function(a){return j("contents",{},{id:a})},v.contentCreate=function(a,b){return j("contentCreate",a,{method:b})},v.contentUpdate=function(a,b){return j("contentUpdate",b,{id:a})},v.contentDelete=function(a){return j("contentDelete",{},{id:a})},v.contentOrder=function(a,b){return j("contentCreate",a,{method:b,param:"order"})},v.revisions=function(a){return j("revisions",{},{id:a})},v.revert=function(a,b){return j("revert",{revisionNumber:b},{id:a})},v.files=function(a,b,c){return j("files",{},{page:a,limit:b,kw:c})},v.file=function(a){return j("file",{},{id:a})},v.fileUpdate=function(a,b){return j("fileUpdate",b,{id:a})},v.fileDelete=function(a){return j("fileDelete",{},{id:a})}}]),App.service("Storage",["Config","pouchDbDriver","localStorageDriver","$rootScope","__",function(a,b,c,d,e){function f(){var a=h[j.driver];return i&&(i=!1,j.setDriver(g)),a}var g,h={pouchDb:b,localStorage:c},i=!1,j=this;this.driver=a.defaultDbDriver,this.setDriver=function(a){return j.driver=a,j},this.setDriverOnce=function(a){return g=this.driver,i=!0,j.setDriver(a),j},this.getUniqKey=function(b,c){return"undefined"==typeof b&&(b=!1),c=c||e.getObjVal(d,["authUser",a.uniqStorageKey]),"undefined"!=typeof c?b===!1?c:b+"_"+c:b},this.get=function(a,b,c){return a=a||"settings",c&&(a=this.getUniqKey(a)),f().get(a,b)},this.set=function(a,b,c,d){return"undefined"==typeof c&&(c=!1),d&&(a=this.getUniqKey(a)),f().set(a,b,c)},this.remove=function(a,b,c){return c&&(a=this.getUniqKey(a)),f().remove(a,b)}}]),App.service("pouchDbDriver",["Config","pouchDB",function(a,b){function c(){d=this,this.db=new b(a.dbName,{auto_compaction:!0,location:2,adapter:window.isCordova?"websql":void 0})}var d;return c.prototype.get=function(a,b){return this.db.get(a).then(function(a){return a})["catch"](function(a){return b})},c.prototype.set=function(a,b,c){return this.db.get(a).then(function(e){var f={};if("object"==typeof e&&c){f=_.cloneDeep(e)||{};for(var g in b)b.hasOwnProperty(g)&&(f[g]=b[g])}else f=b;return d.db.put(f,a,e._rev)})["catch"](function(c){return d.db.put(b,a)})},c.prototype.remove=function(a,b){return this.db.get(a).then(function(c){if(b){if("object"==typeof c){var e=_.cloneDeep(c)||{};delete e[b]}return d.db.put(e,a,c._rev)}return d.db.remove(c)})},new c}]),App.service("localStorageDriver",function(){function a(){b=this}var b;return a.prototype.get=function(a,b){if(!localStorage[a])return b;try{return JSON.parse(localStorage[a])}catch(c){return b}},a.prototype.set=function(a,c,d){var e=b.get(a)||{};if("object"==typeof c&&d)for(var f in c)c.hasOwnProperty(f)&&(e[f]=c[f]);else e=c;return"undefined"!=typeof e&&"undefined"!==e&&(localStorage[a]=JSON.stringify(e)),e},a.prototype.remove=function(a,c){var d=b.get(a);return c?("object"==typeof d&&null!==d&&(delete d[c],b.set(a,d,!1)),d):void delete localStorage[a]},new a}),App.run(["Permission","Auth","$rootScope",function(a,b,c){c.userRoles={guest:"Guest",admin:"Administrator"},c.userRolesArr=_.keys(c.userRoles),a.defineManyRoles(c.userRolesArr,function(a,c){return b.isUserRole(c,a)})}]),App.service("Auth",["Api","$q","__","Storage","$rootScope","$window","$state",function(a,b,c,d,e,f,g){function h(){r.user.routePermissions={};var a=g.get();_.forEach(a,function(a){var b=c.getObjVal(a,"data.permissions.only"),d=c.getObjVal(a,"data.permissions.except"),e=c.getObjVal(a,"name");e&&(r.user.routePermissions[e]=!0,b&&(r.user.routePermissions[e]=_.contains(b,r.user.role)),d&&(r.user.routePermissions[e]=!_.contains(d,r.user.role)))})}function i(){r.user.operationsPermissions={},_.forEach(r.user.permissions,function(a){!r.user.operationsPermissions[a.operation]&&(r.user.operationsPermissions[a.operation]={}),r.user.operationsPermissions[a.operation][a.object]=a.restrictions||{},r.user.operationsPermissions[a.operation][a.object].fields=a.fields})}function j(a,b){"string"==typeof a&&(a=a.split("."));var d=_.union(["operationsPermissions"],a),e=c.getObjVal(r.user,d);if(!e)return!1;d.push("accessibleRoles");var f=c.getObjVal(r.user,d,[]);return!f.length||_.contains(f,b)}function k(a){"string"==typeof a&&(a=a.split("."));var b=_.union(["operationsPermissions"],a);return!!c.getObjVal(r.user,b)}function l(a){return _.isUndefined(a)||((!a||!_.isPlainObject(a))&&(a={}),n(a),r.user=a,d.set("user",a)),h(),i(),e.authUser=r.user,r.user}function m(a,c){if(r.user.role)return r.user.role===a;if(!r.user.role&&"guest"===a)return!0;var d=b.defer();return q(1e3).then(function(b){r.user.role===a?d.resolve():"guest"===a?d.resolve():d.reject()},function(){"guest"===a?d.resolve():d.reject()}),d.promise}function n(a){a.role=c.getObjVal(a,"adminAccess")?"admin":"guest"}function o(b,c){return a.login(b,c).then(function(a){return l(a)})}function p(){return a.logout().then(function(a){return a})["finally"](function(){return l({}),f.stateHistory=[],g.go("login")})}function q(b,c){var d=(new Date).getTime();return t&&b&&s+b>=d?t:(s=d,t=a.hideRespErrorsOnce().user(),t.then(function(a){var b=e.checkErrors(a,c)?{}:_.assign(a,{role:a.adminAccess?"admin":"guest"});l(b)}),t)}var r=this,s=0,t=null,u={isOperationForRolePermitted:j,isOperationPermitted:k,setUser:l,isUserRole:m,login:o,logout:p,checkSession:q};_.extend(this,u),l(d.get("user",{}))}]),App.service("__",["moment","$stateParams","$state",function(a,b,c){var d=this;d.isObjDefined=function(a,b){if("undefined"==typeof a)return!1;if("string"==typeof b&&(b=b.split(".")),!b||!b.length)return!0;for(var c=a,d=0,e=b.length;e>d;d++)if(c=c[b[d]],"undefined"==typeof c)return!1;return!0},d.defineObj=function(a,b,c){if("undefined"==typeof a&&(a={}),"undefined"==typeof c&&(c={}),"string"==typeof b&&(b=b.split(".")),!b||!b.length)return a;for(var d=a,e=0,f=b.length;f>e;e++)"undefined"==typeof d[b[e]]&&(d[b[e]]=e===f-1?c:{}),d=d[b[e]];return a},d.getObjVal=function(a,b,c,d,e){if(("undefined"==typeof a||!a)&&(a={}),"string"==typeof b&&(b=b.split(".")),d=d||0,!b||!b.length)return c;for(var f=a,g=0,h=b.length;h>g;g++){if(!f||"object"!=typeof f||"undefined"==typeof f[b[g]]||e&&null===f[b[g]])return c;f=f[b[g]]}return d&&"string"==typeof f&&(f=0>d?f.toLowerCase():f.toUpperCase()),f},d.isObjEmpty=function(a){if(!a||"object"!=typeof a)return!0;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},d.searchInArrayById=function(a,b){for(var c=0,d=a.length;d>c;c++){var e=a[c];if(b===e.id)return e}return void 0},d.defaultKwFunc=function(a,b,c,e){var f=!1;if(!c)return!0;var g=new RegExp(c,"igm"),h=[""];_.forEach(e,function(b){if(b){var c=d.getObjVal(a,b,"");h.push(c),h[0]+=" "+c}});for(var i=0,j=h.length;j>i;i++){var k=h[i];if(f=g.test(k))break}return f},d.toArray=function(a){if(a instanceof Array)return a;if(a instanceof String)return[a];if(a instanceof Object){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b}return[]},d.stateParam=function(a,c,d,e){var f=b[a]?b[a]:c;if("string"==typeof f&&"/"===f.charAt(0)&&(f=f.substr(1)),e||"undefined"!=typeof f)switch(d){case"int":f=parseInt(f);break;case"float":f=parseFloat(f)}return f},d.stateIntParam=function(a,b,c){return d.stateParam(a,b,"int",c)},d.stateFloatParam=function(a,b,c){return d.stateParam(a,b,"float",c)},d.stateName=function(){return c.current.name},d.max=function(){return Math.max.apply(this,arguments)},d.getRnd=function(a){var b=Math.random();return a&&(b=(b+"").split(".")[1]),b},d.now=function(){return(new Date).getTime()},d.dateToNumber=function(b){var c=a(b);return+c.format("YYYYMMDD")},d.dateTimeToNumber=function(b){var c=a(b);return 1e4*d.dateToNumber(b)+c.diff(c.startOf("day"),"minutes")},d.dateSecToNumber=function(b){var c=a(b);return 1e5*d.dateToNumber(b)+c.diff(c.startOf("day"),"seconds")},d.checkDatesRanges=function(b,c,d){return b?void _.forEach(c,function(c){var e=c[0],f=c[1],g=b[e],h=b[f],i=d?d[e]:null;if(!g||!h)return!0;var j=i&&a(g).unix()!==a(i).unix();a(g).isAfter(a(h))&&(j?b[f]=b[e]:b[e]=b[f])}):!1},d.getLocalTz=function(){return a().format("Z")},d.getLocalTzOffset=function(){return a().utcOffset()},d.getOffsetFromTz=function(b){return"number"==typeof b&&!isNaN(b)&&isFinite(b)?b:a().utcOffset(b).utcOffset()},d.changeTimezone=function(b,c,e,f){function g(b){return b=a(b).utc().add(j,"minute").format()}if(!c)return e;var h=d.getOffsetFromTz(b),i=d.getOffsetFromTz(c),j=h-i;return f?(_.forEach(f,function(a){e[a]&&(e[a]=g(e[a]))}),e):g(e)},d.changeTimezoneToLocal=function(a,b,c){return d.changeTimezone(a,d.getLocalTzOffset(),b,c)},d.changeTimezoneToRemote=function(a,b,c){return d.changeTimezone(d.getLocalTzOffset(),a,b,c)},d.slug=function(a){if(!a)return"";a=a.replace(/^\s+|\s+$/g,""),a=a.toLowerCase();for(var b="ãàáäâẽèéëêìíïîõòóöôùúüûñç·/_,:;",c="aaaaaeeeeeiiiiooooouuuunc------",d=0,e=b.length;e>d;d++)a=a.replace(new RegExp(b.charAt(d),"g"),c.charAt(d));return a=a.replace(/[^a-z0-9 -\.]/g,"").replace(/\s+/g,"-").replace(/\.+/g,"-").replace(/-+/g,"-")},d.groupRegistrationFormItems=function(a){!a.all&&(a.all=[]),a.root=[],a.groups={},_.forEach(a.all,function(b){var c=b.registrationFormItem||b;"group"===c.type&&(a.groups[c.id]=[])}),_.forEach(a.all,function(b){var c=b.registrationFormItem||b,d=c.groupId;d&&a.groups[d]?a.groups[d].push(c):a.root.push(c)})},d.roundTo=function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},d.arrToStr=function(a,b,c){return b=b||"name",_.isUndefined(c)&&(c="<br>"),_.pluck(a,b).join(c)},d.isUrl=function(a){return a=a||"",!!a.match(/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)/)},d.isEmbed=function(a){return a=a||"",!!a.match(/(<iframe.+?<\/iframe>)/g)},d.getEmbedSrc=function(a){a=a||"";var b;return a.replace(/(src)=["']([^"']*)["']/gi,function(a,c,d){b=d}),b}}]),App.service("ImageParams",["$q",function(a){return function(b,c,d){d=d||!1;var e=new Image,f=a.defer();return b?(e.onload=function(){var a={url:b,height:e.height,width:e.width,elHeight:null,elWidth:null,scale:null,scaleX:null,scaleY:null};if("undefined"!=typeof c&&c[0]){var g=c[0];a.elHeight=g.clientHeight,a.elWidth=g.clientWidth,a.scale=a.height/a.width>a.elHeight/a.elWidth?a.elHeight/a.height:a.elWidth/a.width,a.scaleX=a.elWidth/a.width,a.scaleY=a.elHeight/a.height}d&&c.attr("data-img-height",a.height).attr("data-img-width",a.width).attr("data-img-scale",a.scale).attr("data-img-scale-x",a.scaleX).attr("data-img-scale-y",a.scaleY).attr("data-img-scaled-width",a.scale*a.width).attr("data-img-scaled-height",a.scale*a.height),f.resolve(a)},e.onerror=function(){f.reject(lang("Image loading error"))},e.src=b,f.promise):(f.reject(lang("Image loading error")),f.promise)}}]),App.service("DevData",["$q","$timeout",function(a,b){var c=((new Date).getTime(),function(c,d){"undefined"==typeof d&&(d=1e3);var e=a.defer();return b(e.resolve.bind(this,c),d),e.promise});this.data=function(){var a=[{},{}];return c(a)},this.noop=function(){return c({})},this.login=this.noop,this.subjectMatters=function(a){var b=[{id:1,name:"Membership"},{id:2,name:"Certification"},{id:3,name:"Products"},{id:4,name:"Materials"},{id:5,name:"Education"},{id:6,name:"Standards & Ballots"},{id:7,name:"Resources"},{id:8,name:"Codes & Regulations"},{id:9,name:"Industry Organizations"},{id:10,name:"Green Building"}],d={data:b};return a?b:c(d)},this.audiences=function(a){var b=[{id:1,name:"Manufacturers & Members (MM)"},{id:2,name:"Architects & Professionals (AP)"},{id:3,name:"Builders & Contractors (BC)"},{id:4,name:"Homeowners (HO)"}],d={data:b};return a?b:c(d)},this.init=function(){var a=this.subjectMatters(!0),b=this.audiences(!0),d={subjectMatters:a,audiences:b};return c(d)}}]),App.factory("SideList",["__","$q","$rootScope",function(a,b,c){return function(){function d(b,c){return a.defaultKwFunc(b,c,h.filters.kw,h.filters.kwSearchFields.length?h.filters.kwSearchFields:h.nameFields)}function e(a){return h.items.searchByCriteria({id:a}).item}function f(a){return h.items.searchByCriteria({id:a}).index}var g,h=this;this.use=!1,this.items=[];var i={module:{},loader:!1,inactive:!1,title:"",listClass:"",items:[],loadedDfd:b.defer(),visible:!1,onSelect:null,onClick:null,namePrefix:"",nameFields:["name"],showLogo:!0,thumbFields:["images","logo","data","thumb"],defaultLogo:"images/no-logo.png",showAddBtn:!0,showHidden:!1,onAdd:_.noop,key:"id",load:_.noop,loadApiMethod:"",type:"",preFiltersTpl:"",treeView:!1,treeNodeFieldName:"",selected:{},filters:{kw:"",kwSearchFields:[],kwFunc:d}};c.$on("$stateChangeStart",function(a,b,c,d,e){h.hide()}),this.getDefaults=function(){return angular.copy(i)},this.showLoader=function(){return h.loader=!0,h},this.hideLoader=function(){return h.loader=!1,h},this.deactivate=function(){return h.inactive=!0,h},this.activate=function(){return h.inactive=!1,h},this.show=function(){return h.visible=!0,h},this.hide=function(){return h.visible=!1,h},this.toggle=function(a){return"undefined"==typeof a&&(a=!h.visible),h.visible=a,a},this.setItems=function(a){return h.items=null,h.items=a,h},this.removeItemById=function(a){var b=f(a);return"undefined"!=typeof b?h.items.splice(b,1):!1},this.updateItemById=function(a,b){var c=f(a);return"undefined"!=typeof c?(h.items[c]=b,b.id===h.selected.id&&h.select(b),!0):!1},this.addItem=function(a,b){return"start"===b?h.items.unshift(a):h.items.push(a),h},this.getItemById=e,this.getItemIndexById=f,this.setSelectedItems=function(a,b){function c(d){_.forEach(d,function(d){a instanceof Array?d._selected=_.contains(a,d[b]):d._selected=d[b]===a,h.treeView&&d[h.treeNodeFieldName]&&d[h.treeNodeFieldName].length&&c(d[h.treeNodeFieldName])})}b=b||h.key;var d=[];return a instanceof Array&&a[0]instanceof Object&&(_.forEach(a,function(a){d.push(a[b])}),a=angular.copy(d)),c(h.items),h},this.getSelected=function(a){function b(d){_.forEach(d,function(d){d._selected&&(a&&c.keys.push(d[a]),c.items.push(d)),h.treeView&&d[h.treeNodeFieldName]&&d[h.treeNodeFieldName].length&&b(d[h.treeNodeFieldName])})}a=a||h.key;var c={keys:[],items:[]};return b(h.items),c},this.getSelectedKeys=function(a){return a=a||h.key,h.getSelected(a).keys},this.getSelectedItems=function(){return h.getSelected().items},this.setUniqueId=function(){return g=Math.random()},this.getUniqueId=function(){return g}}}]),App.service("LeftList",["__","$rootScope","SideList","$q","Api","$state",function(a,b,c,d,e,f){function g(a,c){k.selected=a,k.hide(),k.onSelect&&k.onSelect(a,c),b.$broadcast("leftlist:select",a,c)}function h(){k.select({})}function i(a,b){k.selected=a,k.hide(),k.onClick&&k.onClick(a,b)}function j(b,c){if(k.showLoader(),k.loadedDfd=d.defer(),c){var f=k.loadedDfd.promise;k.setItems(a.getObjVal(c,"data",[])),k.loadedDfd.resolve(c),k.hideLoader()}else{e.setShowHidden(this.showHidden,"once");var g="function"==typeof k.loadApiMethod?k.loadApiMethod():k.loadApiMethod,f=e[g].apply(null,b);f.then(function(b){k.setItems(a.getObjVal(b,"data",[])),k.loadedDfd.resolve(b)},k.loadedDfd.reject)["finally"](k.hideLoader)}return f}c.call(this);var k=this,l={select:g,unselect:h,click:i,load:j};b.$on("$stateChangeSuccess",function(b,c,d,e,f){k.use=!a.getObjVal(c,"data.notUseLeftList",!1),!k.use&&k.setDefaults()}),this.setDefaults=function(a,b){a=a||{};var c=_.assign(k.getDefaults(),l);if(!a.type||k.type!==a.type||b)return a.filters&&(a.filters=_.assign(c.filters,a.filters)),_.assign(k,c,a),k.setUniqueId()},this.getListForSelectedItem=function(b){var c=d.defer();return k.loadedDfd.promise.then(function(){var d=k.items;b.item&&!d.length&&!d.searchByCriteria({id:b.item.id}).item&&d.push(b.item);var g=a.getObjVal(d,[0],{});return b.onSelectCurrent&&b.onSelectCurrent(g.id)?!1:(g=d.searchByCriteria({id:b.itemId}).item,g?c.resolve(g):b.apiMethod?e[b.apiMethod].apply(null,b.apiParams).then(c.resolve,c.reject):c.reject(),void c.promise.then(k.select,k.unselect)["finally"](function(){!k.items.length&&b.notFoundRedirectState&&f.go(b.notFoundRedirectState,b.notFoundRedirectParams)}))},function(){c.reject(),!k.items.length&&b.notFoundRedirectState&&f.go(b.notFoundRedirectState,b.notFoundRedirectParams)}),k.loadedDfd.promise.then(function(){return c.promise},function(){return c.promise})}}]),App.service("RightList",["$rootScope","SideList",function(a,b){function c(b,c){if(!e.changeable)return!1;if(e.multiselect)b._selected=!b._selected;else{for(var d=0,f=e.items.length;f>d;d++)if(e.items[d]._selected){e.items[d]._selected=!1;break}b._selected=!0}e.onSelect&&e.onSelect(b,c),a.$broadcast("rightlist:select",b,c)}function d(a,b,c){c.preventDefault(),c.stopPropagation(),e.onEdit&&e.onEdit(a,b)}b.call(this);var e=this,f={select:c,multiselect:!1,editable:!1,selectable:!0,changeable:!0,edit:d,onEdit:_.noop};this.setDefaults=function(a){a=a||{};var b=_.assign(e.getDefaults(),f);return a.filters&&(a.filters=_.assign(b.filters,a.filters)),_.assign(e,b,a),e.setUniqueId()}}]),App.service("Upload",["FileUploader","Api","__","$rootScope","Modal","$http","$q",function(a,b,c,d,e,f,g){function h(c,d,e){var f=this;"object"!=typeof c&&(c={}),c=_.assign({scope:f,url:"i"===d?b.imagesUploadUrl:b.fileUploadUrl,alias:"data",withCredentials:!0,removeAfterUpload:!0,multiple:!1},c);var g=new a(c);return i(g,d,"default",e),c.multiple||(g.onAfterAddingFile=function(a){var b=g.queue.length;b>1&&g.queue.splice(g.queue[b-1],1)}),g.onErrorItem=function(a,b,c,d){f.showReqError(d)},g}function i(a,b,c,d){"undefined"==typeof c&&(c="default"),"undefined"==typeof d&&(d=!0);var e={i:{ext:["jpg","png","jpeg","gif"],mime:["image/jpeg","image/pjpeg","image/png","image/x-png","image/gif"]},v:{ext:["mp4","flv"],mime:["video/mpeg","video/mpg","video/mp4"]},a:{ext:["mp3"],mime:["audio/mpeg","audio/mpg","audio/mp3"]}},f=[],g=[];if("string"==typeof b&&(b=b.split("")),"object"!=typeof b||b instanceof Array?_.forEach(b,function(a){e[a]&&(f=_.union(f,e[a].ext),g=_.union(g,e[a].mime))}):(f=b.ext,g=b.mime),f.length||g.length){var b={name:c,fn:function(b,c){var e=!0,h=a.isHTML5?b.type:"",i=b.name.slice(b.name.lastIndexOf(".")+1).toLowerCase();return f.length&&(e=_.contains(f,i)),g.length&&h&&e&&(e=_.contains(g,h)),b.filterExt=f,b.filterMime=g,b.mime=h,!e&&d&&a.scope.showNotify(lang("File type must be one of")+": "+f.join(", "),"e",5),e}},h=_.findIndex(a.filters,{name:c});h>-1?a.filters[h]=b:a.filters.push(b)}}function j(a,b,c){var d="";switch(b){case"audio":d="a";break;case"video":d="v";break;case"image":d="i"}return d?i(a,d,b,c):!1}function k(a,b){return _.remove(a.filters,{name:"folder"}),B}function l(a,b){var c=a.file.type,d=c;d.indexOf("/")>-1&&(d=d.substr(0,d.indexOf("/")));var e=a.file.name.match(/(.*)\.(.*)$/)||[];!d&&(d=m(e[2]));var f={fullName:a.file.name,name:e[1]||"",ext:e[2]||"",type:""},g=_.assign({mime:c,type:d,bucket:b.bucket,path:b.path},b);return!g.data&&(g.data={}),g.data.originalFileInfo=f,g}function m(a){var b={flv:"video",mp4:"video",mp3:"audio",jpg:"image",jpeg:"image",png:"image",gif:"image"};return b[a]||""}function n(a){var b=c.getObjVal(a,["_directives","select",0,"element"]);return b&&b.val(""),!!b}function o(b){a.FileSelect.prototype.isEmptyAfterSelection=function(){return b},a.FileSelect.prototype.onChange=function(){var a=this.uploader.isHTML5?this.element[0].files:this.element[0],b=this.getOptions(),c=this.getFilters();this.uploader.isHTML5||this.destroy(),this.uploader.addToQueue(a,b,c),this.isEmptyAfterSelection()&&this.element.prop("value",null)}}function p(a,b,e,f,g){f=f||"images",b.onAfterAddingFile=function(c){b.targetItem=a.input||{}},b.onSuccessItem=function(h,i,j,k){if(d.checkErrors(i))return!1;n(b);var m=l(h,i),o=c.getObjVal(b,"targetItem.id");if(!a.input[f]&&(a.input[f]={}),o===a.input.id)if(g){c.defineObj(a.input,[f,e],[]);var p=e?a.input[f][e]:a.input[f];p.push(m)}else c.defineObj(a.input,[f,e]),e?a.input[f][e]=m:a.input[f]=m},b.onCompleteAll=function(a,c,d,e){b.removeAfterUpload&&b.clearQueue(),n(b)}}function q(a){a=a||"";var b=a.match(/[^\/?#]+(?=$|[?#])/)||[],c=b[0]||"",d=c.lastIndexOf("."),e={};return e.name=d>0?c.substring(0,d):c,e.fullName=c,e.ext=d>0?c.substring(d+1):"",e.type=m(e.ext),e}function r(a){return q(a).name}function s(a){return q(a).ext}function t(a,b,d){if(d){if(13!==d.which)return!1;d.preventDefault(),d.stopPropagation()}var e=a.module.fileUrl;if(!e)return!1;b&&"string"==typeof b&&(b=b.split(""));var f;if(c.isUrl(e)?f=u(e):c.isEmbed(e)&&(f=v(e)),f){var g=!1;if(b){var h=c.getObjVal(f,"data.originalFileInfo.type");g="image"===h&&!_.contains(b,"i")||"video"===h&&!_.contains(b,"v")}g?a.showNotify("Invalid file type","e",3):(!a.input.files&&(a.input.files=[]),a.input.files.push(f))}else a.showNotify("Invalid value","e",2);a.module.fileUrl=""}function u(a){a=a||"";var b,c=q(a),d={data:{originalFileInfo:c},source:a,documentType:c.ext,title:c.name};if("image"!==c.type){var e=x(a);e&&(b=d,b.data.embedCode=e,b.data.originalFileInfo.type="video")}else b=d;return b}function v(a){var b=c.getEmbedSrc(a),d=q(b),e={data:{originalFileInfo:d},source:b,documentType:"video",title:d.name};return e.data.embedCode=a,e.data.originalFileInfo.type=e.documentType="video",e}function w(){}function x(a){var b=z(a);return C[b]?C[b](a):null}function y(a){var b=z(a);return C[b]?C[b](a,!0):null}function z(a){var b,c={youtube:["youtube.com","youtu.be"],vimeo:["vimeo.com"]};return _.forEach(c,function(c,d){_.forEach(c,function(c){return-1!==a.indexOf(c)?(b=d,!1):void 0})}),b}function A(a){var b=e.pageModal(a,"views/components/filesGalleryModal.html");b.onResult=function(b){c.defineObj(a,"input.files",[]),_.forEach(b,function(b){a.input.files.push(b)})}}var B=this,C=new w,D=420,E=345;o(!0);var F={},G={getUploader:h,setFilter:i,setFilterByName:j,getUploadedObj:l,getTypeByExt:m,resetFileInput:n,isEmptyAfterSelection:o,bindUploader:p,getFileNameInfoFromUrl:q,getFileNameFromUrl:r,getFileExtFromUrl:s,addFileFromInput:t,showFilesGallery:A,removeFilter:k,getWysiwygEmbedFromSrc:y};_.assign(B,F,G),w.prototype.youtube=function(a,b){var c=/(?:http?s?:\/\/)?(?:www\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=|embed\/)?(.+)/g;if(b)var d='<img class="ta-insert-video" src="https://img.youtube.com/vi/$1/hqdefault.jpg" ta-insert-video="http://www.youtube.com/embed/$1" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen contenteditable="false" />';else d='<iframe width="'+D+'" height="'+E+'" src="http://www.youtube.com/embed/$1" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>';return a.replace(c,d)},w.prototype.vimeo=function(a,b){var d=/(?:http?s?:\/\/)?(?:www\.)?(?:vimeo)\.com.*(?:videos|video|channels|)\/([\d]+)/gi;if(b){var e=g.defer();return f.jsonp("http://vimeo.com/api/v2/video/143161118.json?callback=JSON_CALLBACK").success(function(b){var f=c.getObjVal(b,[0,"thumbnail_large"]);if(f){var g='<img class="ta-insert-video" ta-insert-video="//player.vimeo.com/video/$1" src="'+f+'" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen contenteditable="false" />';e.resolve(a.replace(d,g))}else e.reject()}).error(e.reject),e.promise}var h='<iframe width="'+D+'" height="'+E+'" src="//player.vimeo.com/video/$1" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>';return a.replace(d,h)}}]),App.service("Gmap",["$window","$q","$rootScope","Storage","__","Config",function(a,b,c,d,e,f){function g(a){return a&&(B=a),B}function h(){if(a.initGmap=function(){z.loaded=!0,A.resolve()},!z.loading&&!z.loaded){z.loading=!0;var b=document.createElement("script");b.src="https://maps.googleapis.com/maps/api/js?sensor=false&callback=initGmap",document.body.appendChild(b),b.onload=b.onreadystatechange=function(){z.loading=!1,b.onload=b.onreadystatechange=null}}return A.promise}function i(c,d,e,f){f=f||{},c=c||C,d=d||z.lastCenter,!d[0]&&(d[0]=D),!d[1]&&(d[1]=E);var g=b.defer();return h().then(function(){a.google&&a.google.maps?l(c,d,e,f)?g.resolve(z.map[B]):g.reject("google map creating error"):g.reject(lang("google map not loaded"))},function(){g.reject(lang("google map not loaded, promise rejected"))}),g.promise}function j(){if(!z.map[B])return!1;var a=z.map[B].getDiv();z.infoWindow.close(),r(),z.map[B]=null,delete z.map[B],google.maps.event.clearInstanceListeners(window),google.maps.event.clearInstanceListeners(document),google.maps.event.clearInstanceListeners(a);try{a.parentNode.removeChild(a)}catch(b){}}function k(){var a=g();for(var b in z.map)g(b),j();g(a)}function l(b,c,d,e){d=d||{};var f=document.getElementById(b);if(!(a.google&&a.google.maps&&f))return!1;z.map[B],d=_.assign({center:new google.maps.LatLng(c[0],c[1]),zoom:z.lastZoom,maxZoom:18,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!1,draggable:!0,zoomControl:!0},d),z.map[B]=new google.maps.Map(f,d),z.markers=[],z.infoWindow=new google.maps.InfoWindow({maxWidth:240}),z.map[B].route=null,google.maps.event.addListener(z.map[B],"idle",function(){google.maps.event.trigger(z.map[B],"resize")}),google.maps.event.addListener(z.map[B],"tilesloaded",function(){google.maps.event.trigger(z.map[B],"resize")}),google.maps.event.addListener(z.map[B],"center_changed",function(){var a=z.map[B].getCenter();z.lastCenter[0]=a.lat(),z.lastCenter[1]=a.lng()}),google.maps.event.addListener(z.map[B],"zoom_changed",function(){z.lastZoom=z.map[B].getZoom()});for(var g in e)!function(a,b){google.maps.event.addListener(b,g,function(c){a(c,b)})}(e[g],z.map[B]);return z.map[B]}function m(a,b){a=a||"blue";var c;switch(a){case"red":c=b?"0xff0000ff":"#ff0000";break;case"grey":c=b?"0x888888ff":"#888888";break;case"orange":c=b?"0xff7200ff":"#ff7200";break;case"purple":c=b?"0x510476ff":"#510476";break;case"blue":default:c=b?"0x43a7e2ff":"#43a7e2"}return c}function n(a,b,c,d,e,f){d=d||40,e=e||{},f=f||{};var g=e.options||{},h=e.userData||{},i=new google.maps.Marker(_.assign({position:new google.maps.LatLng(a,b),map:z.map[B],icon:c?{url:c,scaledSize:new google.maps.Size(d,d),anchor:new google.maps.Point(d/2,d/2)}:void 0},g));i.userData=h;for(var j in f)!function(a,b){google.maps.event.addListener(b,j,function(c){a(c,b)})}(f[j],i);return z.markers.push(i),i}function o(a,b,c,d){for(var e=null,f=0,g=a.length;g>f;f++){var h=a[f],i=b&&c?"images/"+c+"-"+b+".png":null,j=n(h.lat,h.lng,i,null,h,d);e?e.extend(j.position):e=new google.maps.LatLngBounds(j.position,j.position)}google.maps.event.trigger(z.map[B],"resize"),e&&z.map[B].fitBounds(e),setTimeout(function(){z.map[B].getZoom()>16&&z.map[B].setZoom(16)},300),z.map[B].markersBounds=e}function p(a,b){h().then(function(){z.infoWindow.close(),z.infoWindow.setContent('<div class="google-info-window"><div class="wrapper">'+b+"</div></div>"),z.infoWindow.open(z.map[B],a)})}function q(a,b,c,d,e){d=d||{};for(var f=null,g=[],h=a.length,i=a[h-1],j=m(b),k=0,l=h;l>k;k++){a[k].props=a[k].props||{};var o=new google.maps.LatLng(a[k].lat,a[k].lng);g.push(o),f?f.extend(o):f=new google.maps.LatLngBounds(o,o),k===h-1?(a[k].props.zIndex=1e4,n(i.lat,i.lng,"images/"+c+"-"+b+".png",null,a[k].props,e)):n(a[k].lat,a[k].lng,"images/dot-"+b+".png",10,a[k].props,e)}z.map[B].route=new google.maps.Polyline(_.assign({path:g,map:z.map[B],strokeColor:j,strokeWeight:5},d)),google.maps.event.trigger(z.map[B],"resize"),f&&z.map[B].fitBounds(f),z.map[B].markersBounds=f}function r(){z.infoWindow.close();for(var a=0,b=z.markers.length;b>a;a++)z.markers[a].setMap(null);z.markers=[]}function s(){z.map[B].route&&z.map[B].route.setMap(null),z.map[B].route=null}function t(b){c.$watch(function(){var a=document.getElementById(b);return a&&-1===a.className.indexOf("ng-hide")},function(b,c){b&&!c&&a.google&&a.google.maps&&z.map[B]&&(google.maps.event.trigger(z.map[B],"resize"),z.map[B].refreshed=!0)})}function u(a,c){function f(a,b){var c=z.geocoderStatuses[b];if("OK"===b){if(z.geocoderCache.data.location)a.isCached=!0,z.geocoderCache.location.unshift({lat:z.geocoderCache.data.location.lat,lng:z.geocoderCache.data.location.lng,result:a}),z.geocoderCache.location.length>z.geocoderCacheSize&&z.geocoderCache.location.pop(),d.set("geocoderCacheLocation",z.geocoderCache.location,!1);else if(z.geocoderCache.data.address){a.isCached=!0;var f=e.getObjVal(a,[0,"geometry","location"]);f&&(e.defineObj(a,[0,"geometry","lat"],f.lat()),e.defineObj(a,[0,"geometry","lng"],f.lng())),z.geocoderCache.address.unshift({address:z.geocoderCache.data.address,result:a}),z.geocoderCache.address.length>z.geocoderCacheSize&&z.geocoderCache.address.pop(),d.set("geocoderCacheAddress",z.geocoderCache.address,!1)}g.resolve({result:a,status:b,msg:c})}else g.reject({result:a,status:b,msg:c})}var g=b.defer();return a||c?(h().then(function(){var b=v(a,c);b?(z.geocoderCache.data={},f(b,"OK")):(!z.geocoder&&(z.geocoder=new google.maps.Geocoder),z.geocoderCache.data=a?{location:a}:{address:c},z.geocoder.geocode(a?{location:a}:{address:c},f))}),g.promise):(g.reject({status:"ERROR",msg:lang("Invalid location parameter")}),g.promise)}function v(a,b){if(a)for(var c=0,d=z.geocoderCache.location.length;d>c;c++){var f=z.geocoderCache.location[c];if(f.lat===a.lat&&f.lng===a.lng)return f.result}else if(b)for(var c=0,d=z.geocoderCache.address.length;d>c;c++){var f=z.geocoderCache.address[c];if(f.address===b){var g=e.getObjVal(f.result,[0,"geometry","lat"],0),h=e.getObjVal(f.result,[0,"geometry","lng"],0);return e.defineObj(f.result,[0,"geometry","location","lat"],function(){
return g}),e.defineObj(f.result,[0,"geometry","location","lng"],function(){return h}),f.result}}return!1}function w(a){a=a||{};var b={click:function(a,b){b.setOptions({scrollwheel:!0})},mouseout:function(a,b){b.setOptions({scrollwheel:!1})}},c=i(null,null,{scrollwheel:!1},b);c.then(function(b){r();var c={dragend:y},d=e.getObjVal(a,"lat",null),g=e.getObjVal(a,"lng",null);(null===d||null===g)&&(a.lat=f.defaults.location.lat,a.lng=f.defaults.location.lng);var h={lat:a.lat,lng:a.lng,options:{draggable:!0},userData:a};$timeout(function(){r(),o([h],null,null,c)},300)})}function x(a){var b=e.getObjVal(a,"address");if(!b)return!1;if(b instanceof Object){var c=[];c.push(b.country,b.zipcode,b.state,b.city,b.street),b=c.join(" ")}u(null,b).then(function(b){var c=e.getObjVal(b,["result",0,"geometry","location"]);c&&(a.lat=c.lat(),a.lng=c.lng(),w(a))})}function y(a,b){$timeout(function(){var a=b.getPosition();b.userData.lat=a.lat(),b.userData.lng=a.lng()})}var z=this,A=b.defer(),B="gmap",C="gmap",D=f.defaults.location.lat,E=f.defaults.location.lng,F={map:{},markers:[],loading:!1,loaded:!1,geocoder:null,geocoderCacheSize:100,geocoderStatuses:{ERROR:lang("There was a problem contacting the Google servers"),INVALID_REQUEST:lang("Geocoder Request was invalid"),OK:lang("The response contains a valid Geocoder Response"),OVER_QUERY_LIMIT:lang("The application has gone over the requests limit in too short a period of time"),REQUEST_DENIED:lang("The application is not allowed to use the geocoder"),UNKNOWN_ERROR:lang("A geocoding request could not be processed due to a server error. The request may succeed if you try again"),ZERO_RESULTS:lang("No result was found for this Geocoder Request")},geocoderCache:{location:d.get("geocoderCacheLocation",[]),address:d.get("geocoderCacheAddress",[]),data:{}},lastCenter:[],lastZoom:13},G={mapName:g,load:h,getMap:i,destroyMap:j,destroyMaps:k,getColorByName:m,setMapMarker:n,setMapMarkers:o,setInfoWindow:p,setMapRoute:q,removeMarkers:r,removeRoute:s,setRefreshMap:t,geocode:u,showLocationOnMap:w,geocodeAddress:x};_.assign(z,F,G),c.$on("$stateChangeSuccess",k)}]),App.service("Data",["Api","__","RightList","Modal",function(a,b,c,d){function e(){u.inited=a.options(),u.inited.then(g).then(function(){u.isInited=!0})}function f(a,b){var c=u[a];return b&&!c&&(c=b),c}function g(a,b){b?u[b]=a:_.forEach(a,function(a,b){u[b]=a})}function h(){_.assign(u,v)}function i(a,b,c){return a?b.apply(this,c):u.inited.then(function(){return b.apply(this,c)})}function j(a){var b=function(){return u.audienceOptions};return i(a,b)}function k(a){var b=function(){return u.subjectMatterOptions};return i(a,b)}function l(e,f){function g(a,d){l.input.categories=c.getSelected().items,l.input.categoriesStr=b.arrToStr(l.input.categories)}function h(a,b){d.confirmLeaveModal(l,function(){return l.go("categories.profile",{categoryType:f,categoryId:a.id})})}function i(){d.confirmLeaveModal(l,function(){return l.go("categories.add",{categoryType:f})})}function j(a){if(n===c.getUniqueId()){var d=b.getObjVal(a,"data",[]),e=b.getObjVal(l,"input.categories",[]);c.setItems(d).setSelectedItems(e)}}function k(){a.categories(f,"tree").then(j)["finally"](c.hideLoader)}var l=this,m={title:"Categories",multiselect:!0,showAddBtn:!0,changeable:!0,editable:!0,showLogo:!1,treeView:!0,treeNodeFieldName:"categories",onSelect:g,onEdit:h,onAdd:i},n=c.setDefaults(m);c.showLoader().show(),e?e().then(k):k()}function m(e){function f(a,d){k.input.forms=c.getSelected().items,k.input.formsStr=b.arrToStr(k.input.forms,"title")}function g(a,b){d.confirmLeaveModal(k,function(){return k.go("forms.view",{formId:a.id})})}function h(){d.confirmLeaveModal(k,function(){return k.go("forms.add")})}function i(a){if(m===c.getUniqueId()){var d=b.getObjVal(a,"data",[]),e=b.getObjVal(k,"input.forms",[]);c.setItems(d).setSelectedItems(e)}}function j(){a.forms().then(i)["finally"](c.hideLoader)}var k=this,l={title:"Forms",multiselect:!0,showAddBtn:!0,changeable:!0,editable:!0,showLogo:!1,nameFields:["title"],onSelect:f,onEdit:g,onAdd:h},m=c.setDefaults(l);c.showLoader().show(),e?e().then(j):j()}function n(a){function d(a,d){f.input.smOptions=c.getSelected().items,f.input.subjectMattersStr=b.arrToStr(f.input.smOptions)}function e(a){if(h!==c.getUniqueId())return c.hideLoader();var d=b.getObjVal(f,"input.smOptions",[]),e=k("sync");c.setItems(e).setSelectedItems(d).hideLoader()}var f=this,g={title:"Subject Matters",multiselect:!0,showAddBtn:!1,changeable:!0,editable:!1,showLogo:!1,onSelect:d},h=c.setDefaults(g);c.showLoader().show(),a?a().then(e):e({data:b.getObjVal(f,"input.smOptions",[])})}function o(a){function d(a,d){f.input.audienceOptions=c.getSelected().items,f.input.audiencesStr=b.arrToStr(f.input.audienceOptions)}function e(a){if(h!==c.getUniqueId())return c.hideLoader();var d=b.getObjVal(f,"input.audienceOptions",[]),e=j("sync");c.setItems(e).setSelectedItems(d).hideLoader()}var f=this,g={title:"Audiences",multiselect:!0,showAddBtn:!1,changeable:!0,editable:!1,showLogo:!1,onSelect:d},h=c.setDefaults(g);c.showLoader().show(),a?a().then(e):e({data:b.getObjVal(f,"input.audienceOptions",[])})}function p(a){function d(a,b){e.input.groupId=a.id,e.input.parentCategoryStr=a.name,this.hide()}var e=this,f={title:"Categories",items:a,showAddBtn:!1,showLogo:!1,onSelect:d};c.setDefaults(f);var g=b.getObjVal(e,"input.groupId");c.setSelectedItems(g).show()}function q(a){return _.pluck(a,"name")}function r(c){return a.tags({kw:c,limit:100}).then(function(a){return b.getObjVal(a,"data",[])},function(){return[]})}function s(a,c,d){a.Modal.confirmDelete(a,"file",function(){var c=b.getObjVal(a,"input.files",[]);c.splice(d,1),a.showNotify("File successfully deleted","s",2)},d)}function t(a){return a&&"object"==typeof a?void _.forEach(a,function(a){a._order=a.order||0}):!1}var u=this,v={subjectMatterOptions:void 0,audienceOptions:void 0},w={inited:null,isInited:!1,module:{},tzs:[{name:"UTC -12:00",val:"-12:00"},{name:"UTC -11:00",val:"-11:00"},{name:"UTC -10:00",val:"-10:00"},{name:"UTC -09:00",val:"-09:00"},{name:"UTC -08:00",val:"-08:00"},{name:"UTC -07:00",val:"-07:00"},{name:"UTC -06:00",val:"-06:00"},{name:"UTC -05:00",val:"-05:00"},{name:"UTC -04:30",val:"-04:30"},{name:"UTC -04:00",val:"-04:00"},{name:"UTC -03:30",val:"-03:30"},{name:"UTC -03:00",val:"-03:00"},{name:"UTC -02:00",val:"-02:00"},{name:"UTC -01:00",val:"-01:00"},{name:"UTC +00:00",val:"+00:00"},{name:"UTC +01:00",val:"+01:00"},{name:"UTC +02:00",val:"+02:00"},{name:"UTC +03:00",val:"+03:00"},{name:"UTC +03:30",val:"+03:30"},{name:"UTC +04:00",val:"+04:00"},{name:"UTC +04:30",val:"+04:30"},{name:"UTC +05:00",val:"+05:00"},{name:"UTC +05:30",val:"+05:30"},{name:"UTC +05:45",val:"+05:45"},{name:"UTC +06:00",val:"+06:00"},{name:"UTC +06:30",val:"+06:30"},{name:"UTC +07:00",val:"+07:00"},{name:"UTC +08:00",val:"+08:00"},{name:"UTC +09:00",val:"+09:00"},{name:"UTC +09:30",val:"+09:30"},{name:"UTC +10:00",val:"+10:00"},{name:"UTC +11:00",val:"+11:00"},{name:"UTC +12:00",val:"+12:00"},{name:"UTC +13:00",val:"+13:00"},{name:"UTC +14:00",val:"+14:00"}]},x={init:e,getData:f,setData:g,emptyUserData:h,getAudiences:j,getSubjectMatters:k,loadTags:r,getTagsForSave:q,selectCategories:l,selectForms:m,selectSubjectMatters:n,selectAudiences:o,selectParentCategory:p,showDeleteFileModal:s,setFilesOrder:t};_.assign(u,v,w,x),e()}]),App.service("FormBuilder",["__","Modal",function(a,b){function c(){}function d(a){return a.Modal.confirmDelete(a,"element",a.remove)}function e(a){i.formItems=null,i.formItems=a}function f(c,d){var e=a.getObjVal(c,"data.selectOption");return a.getObjVal(c,"data.selectOption")?(a.defineObj(c,"data.options",[]),_.find(c.data.options,{label:e})?b.showAlert("This option already exists!"):(c.data.options.push({id:a.now(),label:e}),c.data.selectOption="",c.data.options)):!1}function g(a,b,c){var d=a.$element.attr("data-node-type"),e=b.$element.attr("data-nodes-type");return d===e?!0:!1}function h(a,b,c){return"selectOption"===a.$element.attr("data-node-type")}var i=this,j={formItems:[]},k={module:{},elements:[{type:"group",isVisible:!0,formItems:[]},{type:"text",isVisible:!0,data:{inputType:"text"}},{type:"textarea",isVisible:!0},{type:"checkbox",isVisible:!0},{type:"radio",isVisible:!0},{type:"select",isVisible:!0,data:{options:[]}},{type:"date",isVisible:!0},{type:"info",isVisible:!0}],properties:{text:{icon:"icon-input",title:"Input"},textarea:{icon:"icon-textarea",title:"Textarea"},group:{icon:"icon-group",title:"Group"},checkbox:{icon:"icon-check-box",title:"Checkbox"},radio:{icon:"icon-radio-button-on",title:"Radio"},select:{icon:"icon-format-list-bulleted",title:"Select"},date:{icon:"icon-format-list-bulleted",title:"Date"},info:{icon:"icon-text",title:"Text"}},inputTypes:[{name:"Text",val:"text"},{name:"Email",val:"email"},{name:"Phone",val:"tel"},{name:"Number",val:"number"},{name:"Password",val:"password"}],sourceTreeOptions:{},targetTreeOptions:{accept:g},selectTreeOptions:{accept:h}},l={deleteNodeConfirm:d,linkItems:e,addSelectOption:f};_.assign(i,j,k,l),c()}]),App.service("Contents",function(){function a(){}var b=this,c={types:[{name:"messaging",title:"Messaging"},{name:"news",title:"News"},{name:"static_page",title:"Static page"},{name:"faq",title:"FAQ"},{name:"digital_media",title:"Digital media"},{name:"call_to_action",title:"Call to action"}],specificFields:{messaging:{featuredImage:"Featured Image",link:"Link",tagline:"Tagline",video:"Youtube or Vimeo URL / embed code"},news:{featuredImage:"Featured Image",seoTitle:"Seo Title",seoDescription:"Seo Description",slug:"Slug",content:"Content",excerpt:"Excerpt",byline:"Byline",categories:"Categories",relatedFiles:{title:"Related Files",upload:"Upload files",select:"Select files from gallery",link:"Image URL, Youtube or Vimeo URL / embed code"}},static_page:{featuredImage:"Featured Image",seoTitle:"Seo Title",seoDescription:"Seo Description",slug:"Slug",content:"Content",excerpt:"Excerpt",byline:"Byline",parentPage:"Parent Page",relatedFiles:{title:"Related Files",upload:"Upload files",select:"Select files from gallery",link:"Image URL, Youtube or Vimeo URL / embed code"}},faq:{title:"Question",content:"Answer",seoTitle:"Seo Title",seoDescription:"Seo Description",slug:"Slug",categories:"Categories",relatedFiles:{title:"Related Files",upload:"Upload files",select:"Select files from gallery",link:"Image URL, Youtube or Vimeo URL / embed code"}},digital_media:{seoTitle:"Seo Title",seoDescription:"Seo Description",galleryType:"Gallery Type"},call_to_action:{featuredImage:"Featured Image",link:"Link",video:"Youtube or Vimeo URL / embed code"}},galleryTypes:[{name:"Image",val:"image"},{name:"Video",val:"video"}],fileUploaderFilter:{digital_media:"i"}},d={};_.assign(b,c,d),a()}),App.service("Modal",["$modal","$rootScope","$q","$timeout",function(a,b,c,d){function e(){b.global=b.global||{};var a=b.global;b.$on("$stateChangeSuccess",function(b,c,d,e,f){p=0,s.$modal&&s.$modal.hide(),s.$pageModal&&s.$pageModal.hide(),a.showPopupActionBtns=!1,m.modal={hideCloseBtn:!1},s=m.modal})}function f(b,c){c=c||lang("Alert"),s.$modal=a({title:c,content:'<div class="text-center">'+lang(b)+"</div>",show:!0,html:!0})}function g(b,c){s.hideCloseBtn=!1,s.buttons=[{content:lang("Ok"),"class":"btn-default",click:c}],s.$modal=a({title:lang("Confirm leaving the page"),content:lang("All changes will be lost"),closeBtnTitle:"Cancel",show:!0,html:!1,templateUrl:"views/components/modal.html",scope:b})}function h(b,c,d,e,f){f=f||{},s.hideCloseBtn=!1,s.buttons=[{content:lang("Delete"),"class":"btn-default",click:d,arg:e,closeOnClick:!0}],f=_.assign({title:lang("Confirm delete the "+c),content:lang("Are you sure you want to delete this "+c+"?"),show:!0,html:!1,templateUrl:"views/components/modal.html",scope:b},f),s.$modal=a(f)}function i(b,c,d){var e;return c instanceof Object?(d=d||c.original,e=c.scaled):e=c,!e&&(e=d),!d&&(d=e),e?(s.$modal=a({show:!0,html:!1,templateUrl:"views/components/imageModal.html",scope:b}),s.image=e,s.originalImage=d,l(s.$modal,{allowZoom:!0}),s.$modal):!1}function j(c,d,e,f){b.global.showPopupActionBtns=!1;var g=c.$parent?c.$parent.$new():c.$new();return _.assign(g,e||{}),s.$pageModal=a({show:!0,html:!0,templateUrl:"views/components/pageModal.html",keyboard:!1,contentTemplate:d,backdrop:"static",scope:g}),f&&(s.$pageModal.$options.animation+=" "+f),l(s.$pageModal,{scope:g,destroyOnHide:!0}),s.$pageModal}function k(b,c){s.hideCloseBtn=!1,s.buttons=[{content:lang("Ok"),"class":"btn-default",click:c}],s.$modal=a({title:lang("Confirm leaving the page"),content:lang("All changes will be lost"),closeBtnTitle:"Cancel",show:!0,html:!1,template:"views/components/modal.html",scope:b})}function l(a,b){b=b||{},b.scope=b.scope||{};var c=a.show,e=a.hide,f=angular.element(document.querySelector("html"));a.show=b.scope.show=function(){c.apply(c,arguments),p++,f.addClass("modal-open"),b.allowZoom&&n&&(n.content="width=device-width, minimum-scale=1, maximum-scale=5, initial-scale=1, user-scalable=yes")},a.hide=b.scope.hide=function(c){e.apply(e,arguments),p--,b.allowZoom&&n&&(n.content=o),b.destroyOnHide&&b.scope?d(function(){a.$element.addClass("ng-hide"),!p&&f.removeClass("modal-open"),b.scope.$destroy()},300):!p&&f.removeClass("modal-open"),a.onResult&&a.onResult(c)}}var m=this,n=document.querySelector('meta[name="viewport"]'),o=n.content,p=0,q={modal:{hideCloseBtn:!1}},r={showAlert:f,confirmLeave:g,confirmDelete:h,imageModal:i,pageModal:j,confirmLeaveModal:k};_.assign(m,q,r);var s=m.modal;e()}]),App.controller("MainCtrl",["$scope","$timeout","$location","$window","$rootScope","Auth","Storage","__","$state","LeftList","RightList","$aside","Modal","Api","Data","FormBuilder","Contents","Upload",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(){a.ckeditorConf={extraPlugins:"uploadimage",filebrowserUploadUrl:a.Config.serverUrl,extraAllowedContent:"img[title]"},f.checkSession(null,!1),t(),u()}function t(){var b=l({templateUrl:"views/components/menu.html",placement:"left",animation:"am-slide-left",container:"body",scope:a,show:!1});a.menu={obj:b,enable:!1,active:"",toggle:function(a){b.$promise.then(function(){"undefined"==typeof a&&(a=!b.$isShown),a?b.show():b.hide()})},show:b.show,hide:b.hide}}function u(){var b=a.global;e.$on("$stateChangeSuccess",function(c,d,e,f,g){a.loader.global=!1,b.stateName=d.name,b.menuItem=d.data.menuItem,a.menu.active=d.menu,b.emptyHeader=!!d.data.emptyHeader,b.inactivePageBg=!!d.data.inactivePageBg,b.isBack=F,b.showActionBtns=!1,F=!1})}function v(a,b,d,e){var f=i.go(a,b,e);return d&&c.replace(),f}function w(c,d,e){switch(d=d||"info"){case"i":d="info";case"info":a.notify.icon="icon-info-outline";break;case"e":d="error";case"error":a.notify.icon="icon-warning";break;case"s":d="success";case"success":a.notify.icon="icon-done"}e=1e3*e||0,a.notify.msg=c,a.notify.type=d,a.notify.show=!0,G&&b.cancel(G),e&&(G=b(x,e))}function x(){a.notify.show=!1}function y(a,b){a=a||{};var c="";"error"===h.getObjVal(a,"data.status")&&(c=h.getObjVal(a,"data.message"));var d=lang("Request error")+"! "+lang(a.statusText)+" ["+lang("Code")+" "+a.status+"].";c=lang(c)||d;var e=h.getObjVal(a,"data.data");if(b&&e){var g=[];if("object"==typeof e)for(var i in e)g.push(lang(e[i]));else g.push(lang(e));g.length&&(c+="<br>"),c+=g.join("<br>")}return w(c,"e",3),401===a.status?f.logout():void 0}function z(a,b,c){if("undefined"==typeof b&&(b=!0),"error"===h.getObjVal(a,"status")){var d=[lang(a.message)],e=['<div class="h4 m0">'+lang(a.message)+"</div>"];a.data&&_.forEach(a.data,function(a){e.push("<div>"+lang(a)+"</div>"),d.push(lang(a))});var f=e.join("");return b&&w(f,"e",3),c?d:f}return!1}function A(a,b){var c=g.get("collapsers",{},!0)[a]||b,d=this.$watchCollection("collapsers",function(b){B(a,b)});return this.$on("$destroy",d),c}function B(a,b){var c=g.get("collapsers",{},!0);c[a]=b,g.set("collapsers",c,!1,!0)}function C(a){window.open(a,"_blank")}function D(b){var c=b?"showPopupActionBtns":"showActionBtns";a.global[c]=!1,!this.module&&(this.module={}),this.module.inputWatcher&&this.module.inputWatcher();var d=this.watchDateRanges||[];this.module.inputWatcher=this.$watch("input",function(b,e){a.global[c]=b!==e,h.checkDatesRanges(b,d,e)},!0)}function E(a,b,c,d,e){return a=a||{},a.id?void n[b](a.id).then(function(b){if(w(e,"s",3),j.type===c&&j.removeItemById(a.id)){var f=h.getObjVal(j,["items",0,"id"],"");d(f)}}):!1}var F=!1,G=null,H={LeftList:j,RightList:k,FormBuilder:p,Contents:q,_:_,__:h,Modal:m,Data:o,Upload:r,Auth:f,Api:n,currentLang:d.currentLang,lang:d.lang,notify:{msg:"",show:!1,type:"",icon:""},global:{isBack:!1,stateName:"",menuItem:"",showActionBtns:!1},loader:{global:!1}},I={go:v,getCollapsers:A,openLink:C,setInputWatcher:D,deleteItem:E},J={authUser:f.user,global:{showPopupActionBtns:!1,useNativePickers:!0,isBack:!1,stateName:"",bottomButtons:[],isCordova:d.globalVars.isCordova},$state:i},K={showReqError:y,checkErrors:z,showNotify:w,hideNotify:x};_.assign(a,H,I),_.assign(e,J,K),s()}]),App.controller("AuthCtrl",["$scope","Auth","Data","Api","__",function(a,b,c,d,e){function f(){b.login(a.input.email,a.input.password).then(function(b){c.init(),a.go("users.profile")})}function g(){d.passwordRestore(a.input.email).then(function(b){e.getObjVal(b,"success")&&(a.showNotify("Check the email","s",3),a.go("password.reset"))})}function h(){d.passwordReset(a.input.token,a.input.password).then(function(b){e.getObjVal(b,"success")&&(a.showNotify("Password successfully changed","s",3),a.go("login"))})}var i=e.stateParam("resetToken"),j={input:{email:"user@aamanet.org",token:i},module:{showResetTokenField:!i}},k={login:f,passwordRestore:g,passwordReset:h};_.assign(a,j,k)}]),App.controller("UsersCtrl",["$scope","Api","__","$modal","LeftList","Auth","Upload","Data","taApplyCustomRenderers","moment",function(a,b,c,d,e,f,g,h,i,j){function k(){m(),p(),l()}function l(){switch(c.stateName()){case"users.add":e.selected={},r();break;case"users.profile":q().then(function(a){r(a),t(!0)})}}function m(){if(e.type===B)return!1;var b={type:B,title:"Users list",listClass:"",filters:{},preFiltersTpl:"",loadApiMethod:"users",nameFields:["firstName","lastName"],defaultLogo:"images/no-user.png",showAddBtn:a.userPermissions.add,onAdd:n,onClick:o,module:{}};e.setDefaults(b),e.load([void 0,e.filters.role])}function n(){a.go("users.add")}function o(b,c){return a.go("users.profile",{userId:b.id})}function p(b){b=b||{};var c=a.userPermissions;c.add=!0,c.edit=!0,c["delete"]=!0,c.hide=!0,a.dropdown.userOptions.deleteByCriteria({id:"delete"}),c["delete"]&&a.dropdown.userOptions.push({text:lang("Delete user"),click:"showDeleteModal()",id:"delete"}),e.showAddBtn=c.add,c=null}function q(){function b(b){return!D&&b?a.go("users.profile",{userId:b},!0):!1}var c=D||f.user.id,d={itemId:c,onSelectCurrent:b,apiMethod:"users",apiParams:[c],notFoundRedirectState:"users.add",notFoundRedirectParams:{}};c===f.user.id&&(d.item=f.user);var g=e.getListForSelectedItem(d);return g}function r(b){c.getObjVal(b,"id")?(a.input=_.assign(_.cloneDeep(b),{audienceOptions:C.audienceOptions,smOptions:C.smOptions,categories:C.categories}),a.input.subjectMattersStr=C.smOptions?c.arrToStr(C.smOptions):void 0,a.input.audiencesStr=C.audienceOptions?c.arrToStr(C.audienceOptions):void 0,a.input.categoriesStr=C.categories?c.arrToStr(C.categories):void 0):a.input={isFeatured:!1,isPrivate:!1,isVisible:!1,audienceOptions:[],smOptions:[],categories:[],tags:[],order:1,audiencesStr:"",subjectMattersStr:"",categoriesStr:"",publishDate:j().toISOString()},!a.input.data&&(a.input.data={}),h.setFilesOrder(a.input.files),p(a.input),a.setInputWatcher()}function s(){var b=b||a.input;if(b.id)return b.id===f.user.id?(a.modal.$modal=d({title:lang("Error"),content:lang("You can't delete yourself"),show:!0,html:!1}),!1):void a.Modal.confirmDelete(a,"user",z,b)}function t(c){if(!D)return!1;if(c||!C.contentsDataDfd){var d=D;C.contentsDataDfd=b.users(D),C.contentsDataDfd.then(function(b){d===D&&(u(b),a.setInputWatcher())})}return C.contentsDataDfd}function u(b){var d=c.getObjVal(b,"audienceOptions",[]);a.input.audienceOptions=d,a.input.audiencesStr=c.arrToStr(a.input.audienceOptions),C.audienceOptions=_.cloneDeep(d);var e=c.getObjVal(b,"smOptions",[]);a.input.smOptions=e,a.input.subjectMattersStr=c.arrToStr(a.input.smOptions),C.smOptions=_.cloneDeep(e);var f=c.getObjVal(b,"categories",[]);a.input.categories=f,a.input.categoriesStr=c.arrToStr(a.input.categories),C.categories=_.cloneDeep(f)}function v(){return D?t:null}function w(){h.selectCategories.call(a,v(),"user")}function x(){h.selectAudiences.call(a,v())}function y(){h.selectSubjectMatters.call(a,v())}function z(b){if(b=b||a.input,c.getObjVal(b,"id",0)===f.user.id)return!1;var d=function(b){a.go("users.profile",{userId:b})};a.deleteItem(b,"userDelete",B,d,lang("User successfully deleted"))}function A(){if(b.activeReqs.userUpdate||b.activeReqs.userCreate)return!1;var d,g,j=c.getObjVal(a,"input.data.wysiwygBio");if(a.input.bio=j?i(j):"",a.input.tags=h.getTagsForSave(a.input.tags),e.deactivate(),D){d=function(b){a.showNotify(lang("User successfully updated"),"s",3),b.id===f.user.id&&f.setUser(b),e.type===B&&(b.id===a.input.id&&r(b),u(b),e.updateItemById(D,b))},!a.input.password&&delete a.input.password;var g=b.userUpdate(D,a.input)}else d=function(b){a.showNotify(lang("User successfully added"),"s",3),e.type===B&&e.filters.role===b.role&&(e.addItem(b),a.go("users.profile",{userId:b.id}))},g=b.userCreate(a.input);g.then(d)["finally"](e.activate)}var B="users",C={},D=c.stateIntParam("userId"),E={input:{},module:{reservations:void 0,registrations:void 0},userPermissions:{},dropdown:{userOptions:[]},collapsers:a.getCollapsers(B,{information:!1,contacts:!1,settings:!1,dates:!1,relatedFiles:!1}),logoUploader:g.getUploader.call(a,{autoUpload:!0},"i"),fileUploader:g.getUploader.call(a,{autoUpload:!0,multiple:!0},"")},F={showDeleteModal:s,save:A,prepare:r,selectAudiences:x,selectSubjectMatters:y,selectCategories:w};_.assign(a,E,F),g.bindUploader(a,a.logoUploader,"logo"),g.bindUploader(a,a.fileUploader,void 0,"files",!0),k()}]),App.controller("FormsCtrl",["$scope","__","LeftList","Api",function(a,b,c,d){function e(){switch(g(),f(),b.stateName()){case"forms.add":c.selected={},k();break;case"forms.view":j().then(function(a){k(a),r&&o(!0)})}}function f(b){b=b||{};var d=a.userPermissions;d.add=!0,d.edit=!0,d["delete"]=!0,a.dropdown.formOptions.deleteByCriteria({id:"delete"}),d["delete"]&&a.dropdown.formOptions.push({text:lang("Delete form"),click:"showDeleteModal()",id:"delete"}),c.showAddBtn=d.add,d=null}function g(){if(c.type!==p){var a={type:p,title:"Forms list",loadApiMethod:"forms",nameFields:["title"],showAddBtn:!0,showLogo:!1,onAdd:h,onClick:i,module:{formsList:[]}};c.setDefaults(a),c.load()}}function h(){a.go("forms.add")}function i(b,c){return a.go("forms.view",{formId:b.id})}function j(){function b(b){return!r&&b?a.go("forms.view",{formId:b},!0):!1}var d={itemId:r,onSelectCurrent:b,apiMethod:"forms",apiParams:[r],notFoundRedirectState:"forms.add"};return c.getListForSelectedItem(d)}function k(c){b.getObjVal(c,"id")?a.input=_.cloneDeep(c):a.input={},!a.input.formItems&&(a.input.formItems=[]),a.FormBuilder.linkItems(a.input.formItems),a.setInputWatcher()}function l(){a.Modal.confirmDelete(a,"form",m)}function m(b){b=b||a.input;var c=function(b){a.go("forms.view",{formId:b})};a.deleteItem(b,"formDelete",p,c,lang("Form successfully deleted"))}function n(){if(d.activeReqs.formUpdate||d.activeReqs.formCreate)return!1;if(!a.formForm.formTitle.$valid)return a.showNotify("Enter valid title","e",3);if(!a.formForm.formEmail.$valid)return a.showNotify("Enter valid email","e",3);var b,e;c.deactivate(),r?(e=d.formUpdate(r,a.input),b=function(b){a.showNotify(lang("Form successfully updated"),"s",2),c.type===p&&(b.id===a.input.id&&k(b),c.updateItemById(r,b))}):(e=d.formCreate(a.input),b=function(b){a.showNotify(lang("Form successfully added"),"s",2),c.type===p&&(c.addItem(b),a.go("forms.view",{formId:b.id}))}),e.then(b)["finally"](c.activate)}function o(b){if(b||!q.formsDataDfd){var c=r;q.formsDataDfd=d.forms(r),q.formsDataDfd.then(function(b){c===r&&a.setInputWatcher()})}return q.formsDataDfd}var p="forms",q={},r=b.stateIntParam("formId"),s={input:{},module:{formId:r},userPermissions:{},dropdown:{formOptions:[]},collapsers:a.getCollapsers(p,{information:!1,settings:!1})},t={showDeleteModal:l,prepare:k,save:n};_.assign(a,s,t),e()}]),App.controller("ContentsCtrl",["$scope","Api","__","LeftList","Upload","Data","Contents","taApplyCustomRenderers","moment",function(a,b,c,d,e,f,g,h,i){function j(){switch(a.global.menuItem=(_.find(g.types,{name:C})||{}).title,l(),k(),c.stateName()){case"contents.add":d.selected={},p();break;case"contents.profile":o().then(function(a){p(a),u(!0)})}}function k(b){b=b||{};var c=a.userPermissions;c.add=!0,c.edit=!0,c["delete"]=!0,c.audiencesEdit=!0,a.dropdown.contentOptions.deleteByCriteria({id:"delete"}),c["delete"]&&a.dropdown.contentOptions.push({text:lang("Delete content"),click:"showDeleteModal()",id:"delete"}),d.showAddBtn=c.add,c=null}function l(){if(d.type!==D){var b={type:D,title:"Messages list",loadApiMethod:"contents",showAddBtn:!0,nameFields:["title"],thumbFields:["images","featuredImage","data","thumb"],showLogo:a.specificFields.featuredImage,onAdd:m,onClick:n,module:{contentsList:[]}};d.setDefaults(b),d.load([C])}}function m(){a.go("contents.add")}function n(b,c){return a.go("contents.profile",{contentId:b.id})}function o(){function b(b){return!F&&b?a.go("contents.profile",{contentType:C,contentId:b},!0):!1}var c={itemId:F,onSelectCurrent:b,apiMethod:F?"contents":null,apiParams:[F,C],notFoundRedirectState:"contents.add"};return d.getListForSelectedItem(c)}function p(b){c.getObjVal(b,"id")?(a.input=_.assign(_.cloneDeep(b),{audienceOptions:E.audienceOptions,smOptions:E.smOptions,forms:E.forms,categories:E.categories}),a.input.subjectMattersStr=E.smOptions?c.arrToStr(E.smOptions):void 0,a.input.audiencesStr=E.audienceOptions?c.arrToStr(E.audienceOptions):void 0,a.input.formsStr=E.forms?c.arrToStr(E.forms,"title"):void 0,a.input.categoriesStr=E.categories?c.arrToStr(E.categories):void 0):a.input={isFeatured:!1,isPrivate:!1,isVisible:!1,audienceOptions:[],smOptions:[],forms:[],categories:[],order:1,tags:[],audiencesStr:"",subjectMattersStr:"",categoriesStr:"",formsStr:"",publishDate:i().toISOString(),galleryType:"image",files:[]},s(),f.setFilesOrder(a.input.files),a.setInputWatcher()}function q(){a.Modal.confirmDelete(a,"content",r)}function r(b){b=b||a.input;var c=function(b){a.go("contents.profile",{contentId:b})};a.deleteItem(b,"contentDelete",D,c,lang("Item successfully deleted"))}function s(){return F?void b.revisions(F).then(function(b){a.revisions=c.getObjVal(b,"data",[])}):!1}function t(){if(b.activeReqs.contentUpdate||b.activeReqs.contentCreate)return!1;var e,g,i=c.getObjVal(a,"input.wysiwygContent");a.input.content=i?h(i):"",a.input.tags=f.getTagsForSave(a.input.tags),d.deactivate(),F?(g=b.contentUpdate(F,a.input),e=function(b){a.showNotify(lang("Item successfully updated"),"s",2),d.type===D&&(b.id===a.input.id&&p(b),v(b),d.updateItemById(F,b))}):(g=b.contentCreate(a.input,C),e=function(b){a.showNotify(lang("Item successfully added"),"s",2),d.type===D&&(d.addItem(b),a.go("contents.profile",{contentId:b.id}))}),g.then(e)["finally"](d.activate)}function u(c){if(!F)return!1;if(c||!E.contentsDataDfd){var d=F;E.contentsDataDfd=b.content(F),E.contentsDataDfd.then(function(b){d===F&&(v(b),a.setInputWatcher())})}return E.contentsDataDfd}function v(b){var d=c.getObjVal(b,"audienceOptions",[]);a.input.audienceOptions=d,a.input.audiencesStr=c.arrToStr(a.input.audienceOptions),E.audienceOptions=_.cloneDeep(d);var e=c.getObjVal(b,"smOptions",[]);a.input.smOptions=e,a.input.subjectMattersStr=c.arrToStr(a.input.smOptions),E.smOptions=_.cloneDeep(e);var f=c.getObjVal(b,"forms",[]);a.input.forms=f,a.input.formsStr=c.arrToStr(a.input.forms,"title"),E.forms=_.cloneDeep(f);var g=c.getObjVal(b,"categories",[]);a.input.categories=g,a.input.categoriesStr=c.arrToStr(a.input.categories),E.categories=_.cloneDeep(g)}function w(){return F?u:null}function x(){f.selectForms.call(a,w())}function y(){f.selectAudiences.call(a,w())}function z(){f.selectSubjectMatters.call(a,w())}function A(){f.selectCategories.call(a,w(),C)}function B(a){return F&&a?void b.revert(F,a).then(function(a){p(a),u(!0)}):!1}var C=c.stateParam("contentType"),D="contents-"+C,E={},F=c.stateIntParam("contentId"),G={specificFields:c.getObjVal(g.specificFields,[C],{}),input:{},module:{contentId:F,contentType:C},userPermissions:{},dropdown:{contentOptions:[]},collapsers:a.getCollapsers(D,{information:!1,contacts:!0,social:!1,settings:!1,relatedFiles:!1,revisions:!1,dates:!1}),featuredImageUploader:e.getUploader.call(a,{autoUpload:!0,multiple:!0},"i"),fileUploader:e.getUploader.call(a,{autoUpload:!0,multiple:!0},c.getObjVal(g,["fileUploaderFilter",C],""))},H={showDeleteModal:q,save:t,prepare:p,selectForms:x,selectAudiences:y,selectSubjectMatters:z,selectCategories:A,revert:B};_.assign(a,G,H),e.bindUploader(a,a.featuredImageUploader,"featuredImage"),e.bindUploader(a,a.fileUploader,void 0,"files",!0),j()}]),App.controller("PageOrderCtrl",["$scope","Api","__",function(a,b,c){function d(){e().then(function(a){f(c.getObjVal(a,"data",[]))})}function e(){return b.contents("static_page","tree")}function f(b){a.unpreparedItem=_.cloneDeep(b||{}),a.input.pages.length=0,g(b),Array.prototype.push.apply(a.input.pages,b),a.setInputWatcher()}function g(a){_.forEach(a,function(a){a.pages?g(a.pages):a.pages=[]})}function h(){var d=b.contentOrder({data:a.input.pages},"static_page");d.then(function(b){a.showNotify(lang("Order successfully updated"),"s",2),f(c.getObjVal(b,"data",[]))})}var i={input:{pages:[]}},j={save:h,prepare:f};_.assign(a,i,j),d()}]),App.controller("UploadImageCtrl",["$scope","Upload","__",function(a,b,c){function d(){}function e(b,d){a.imageUploader.removeFromQueue(b);var e=c.getObjVal(a,"input.images.image",[]);e=e.splice(e.length-d-1,1)}var f={input:{},imageUploader:b.getUploader.call(a,{autoUpload:!0,removeAfterUpload:!1,multiple:!0},"i")},g={removeFileFromQueue:e};_.assign(a,f,g),b.bindUploader(a,a.imageUploader,"image",null,!0),d()}]),App.controller("CategoriesCtrl",["$scope","Api","__","LeftList","Data",function(a,b,c,d,e){function f(){switch(a.global.menuItem=a.typeTitles[r],h(),g(),c.stateName()){case"categories.add":d.selected={},l();break;case"categories.profile":k().then(function(a){l(a)})}}function g(b){b=b||{};var c=a.userPermissions;c.add=!0,c.edit=!0,c["delete"]=!0,c.audiencesEdit=!0,a.dropdown.categoryOptions.deleteByCriteria({id:"delete"}),c["delete"]&&a.dropdown.categoryOptions.push({text:lang("Delete category"),click:"showDeleteModal()",id:"delete"}),d.showAddBtn=c.add,c=null}function h(){if(d.type===t)return!1;var a={type:t,title:"Categories list",loadApiMethod:"categories",showAddBtn:!0,showLogo:!1,onAdd:i,onClick:j,module:{categoriesList:[]}};d.setDefaults(a),d.load([r])}function i(){a.go("categories.add")}function j(b,c){return a.go("categories.profile",{categoryId:b.id})}function k(){function b(b){return!s&&b?a.go("categories.profile",{categoryType:r,categoryId:b},!0):!1}var c={itemId:s,onSelectCurrent:b,apiMethod:s?"category":void 0,apiParams:s,notFoundRedirectState:"categories.add"};return d.getListForSelectedItem(c)}function l(b){if(c.getObjVal(b,"id")){a.input=_.cloneDeep(b);var e=c.searchInArrayById(d.items,a.input.groupId)||{};a.input.parentCategoryStr=e.name||""}else a.input={isFeatured:!1,isPrivate:!1,isVisible:!1,order:1,parentCategoryStr:""};a.setInputWatcher()}function m(){a.Modal.confirmDelete(a,"category",n)}function n(b){b=b||a.input;var c=function(b){a.go("categories.profile",{categoryId:b})};a.deleteItem(b,"categoryDelete",t,c,lang("Item successfully deleted"))}function o(){if(b.activeReqs.categoryUpdate||b.activeReqs.categoryCreate)return!1;var c,e;d.deactivate(),s?(e=b.categoryUpdate(s,a.input),c=function(b){a.showNotify(lang("Item successfully updated"),"s",2),d.type===t&&(b.id===a.input.id&&l(b),d.updateItemById(s,b));
}):(e=b.categoryCreate(a.input,r),c=function(b){a.showNotify(lang("Item successfully added"),"s",2),d.type===t&&(d.addItem(b),a.go("categories.profile",{categoryId:b.id}))}),e.then(c)["finally"](d.activate)}function p(){d.loadedDfd.promise.then(function(b){var d=_.cloneDeep(c.getObjVal(b,"data",[]));d=_.filter(d,function(b,c){return b.id!==a.input.id&&!b.groupId}),e.selectParentCategory.call(a,d)})}function q(){a.input.groupId=null,a.input.parentCategoryStr=""}var r=c.stateParam("categoryType"),s=c.stateParam("categoryId",void 0,"int"),t="categories-"+r,u={input:{},module:{categoryId:s,categoryType:r},typeTitles:{user:"Users categories",news:"News categories",faq:"FAQ categories"},userPermissions:{},dropdown:{categoryOptions:[]},collapsers:a.getCollapsers(t,{information:!1,settings:!1})},v={showDeleteModal:m,save:o,prepare:l,selectParentCategory:p,clearParentCategory:q};_.assign(a,u,v),f()}]),App.controller("FilesGalleryCtrl",["$scope","Api","$timeout","__","$sce",function(a,b,c,d,e){function f(){g()}function g(c){c=c||a.pagination.page,a.pagination.page=c,b.files(c,l,a.input.kw).then(function(b){a.files=d.getObjVal(b,"data",[]),a.pagination.count=d.getObjVal(b,"count",a.files.length),i(),j()})}function h(b,d){!_.isUndefined(b)&&(a.input.kw=b),_.isUndefined(d)&&(d=500),c.cancel(m),m=c(g.bind(a,1),d)}function i(){_.forEach(a.files,function(b){var c=a.Upload.getTypeByExt(d.getObjVal(b,"data.originalFileInfo.ext","")),f=d.getObjVal(b,"data.embedCode");if(c||(c=a.Upload.getTypeByExt(b.documentType)),c||(c=f?"video":b.documentType),b.type=c,f){var g=angular.element("<div>"+f+"</div>"),h=g.children(),i=h.attr("src").replace("autoplay=1","autoplay=0");h.attr({width:"100%",height:"100%",src:i}),b.data.previewEmbedCode=e.trustAsHtml(g.html())}})}function j(){var b=Math.ceil(a.pagination.count/l);a.pagination.pages=b,a.pagination.next=a.pagination.page<b?g.bind(this,a.pagination.page+1):null,a.pagination.prev=a.pagination.page>1?g.bind(this,a.pagination.page-1):null}function k(b){a.module.selected[b.id]?delete a.module.selected[b.id]:a.module.selected[b.id]=b}var l=36,m=null,n={input:{kw:""},module:{selected:{},count:0},pagination:{pages:1,page:1},files:void 0},o={search:h,selectFile:k};_.assign(a,n,o),f()}]);